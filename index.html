<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英語学習フラッシュカード</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* コンテンツを上部に配置 */
            min-height: 100vh; /* 画面の高さいっぱいに表示 */
            height: 100%; /* スクロールバー対策 */
            background: #000; /* フォールバック背景色 */
            color: white;
            overflow-x: hidden; /* 横スクロールバーを防止 */
            position: relative; /* 背景要素の基準点 */
            box-sizing: border-box; /* paddingを含めて計算 */
        }

        /* 銀河背景のアニメーション */
        body:before {
            content: "";
            position: fixed; /* 背景を固定 */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(125deg, #090e29, #020024, #1e0a3d, #09244c);
            background-size: 400% 400%; /* アニメーションのために拡大 */
            z-index: -2; /* コンテンツの下に配置 */
            animation: galaxyMove 20s ease infinite; /* アニメーション */
        }

        /* 星のきらめき効果 */
        .stars {
            position: fixed; /* 星を固定 */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* クリックイベントを無効化 */
            z-index: -1; /* 背景とコンテンツの間に配置 */
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            /* アニメーションのプロパティをCSS変数で設定 */
            animation: twinkle var(--duration) ease-in-out infinite;
            opacity: var(--opacity); /* 初期透明度 */
        }

        @keyframes galaxyMove {
            0% { background-position: 0% 50% }
            50% { background-position: 100% 50% }
            100% { background-position: 0% 50% }
        }

        /* 修正: より安定した星の瞬きアニメーション */
        @keyframes twinkle {
            0%, 100% {
                /* 開始/終了時は基本の透明度 */
                opacity: var(--opacity);
                transform: scale(1);
            }
            20% {
                /* 少し暗く、小さく (元の60%) */
                opacity: calc(var(--opacity) * 0.6);
                transform: scale(0.9);
            }
            50% {
                /* やや明るく、大きく (元の95%) */
                 opacity: calc(var(--opacity) * 0.95);
                 transform: scale(1.05);
            }
             80% {
                 /* 再び暗く (元の50%) */
                 opacity: calc(var(--opacity) * 0.5);
                 transform: scale(0.95);
             }
        }


        h1 {
            font-weight: 600;
            margin: 10px 0 5px; /* 上下のマージン調整 */
            color: #ffffff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.7), 0 0 20px rgba(255, 255, 255, 0.5);
            font-size: 2.2rem;
            letter-spacing: 1px;
        }

        /* カテゴリ選択グリッドのスタイル */
        .category-grid {
             display: grid;
             grid-template-columns: repeat(3, max-content); /* ★ 列幅を内容に合わせる */
             justify-content: center; /* ★ グリッドアイテムを中央揃え */
             grid-gap: 15px;
             margin: 15px auto 20px auto; /* 上下マージン調整 */
        }

        /* カテゴリカードの共通スタイル */
        .category-card {
            background: linear-gradient(135deg, rgba(36, 123, 205, 0.3), rgba(16, 54, 140, 0.2));
            /* padding: 5px 10px; */ /* ★ 変更前 */
            padding: 20px 10px; /* ★ 上下パディングを増加 */
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1); /* デフォルトボーダー */
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* ★ カテゴリカード内の h3 (ランク表示) スタイル */
        .category-card h3 {
            margin: 0; /* マージンリセット */
            font-size: 0.9rem; /* フォントサイズ */
            color: white;
            font-weight: 500;
            line-height: 1.2; /* 行間 */
        }

        /* 選択中のカテゴリカード */
        .category-card.active {
             border: 2px solid rgba(52, 152, 219, 0.6); /* 強調ボーダー */
             box-shadow: 0 0 10px rgba(52, 152, 219, 0.3); /* 軽い光彩 */
        }

        .card-container {
            width: 90%; /* 幅を画面比率で設定 */
            max-width: 400px; /* 最大幅を設定 */
            aspect-ratio: 1000 / 618; /* ★ 黄金比 (横長) に戻す */
            perspective: 1500px; /* 3D効果の奥行き */
            margin: 10px auto 20px auto; /* 上下マージン調整 (上を詰める) */
            position: relative;
            z-index: 1; /* コントロールパネルより奥 */
        }

        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d; /* 3D空間で子要素を配置 */
            transition: transform 0.5s ease; /* 回転アニメーション（より直線的に） */
            cursor: default; /* 通常はクリック不可 */
        }

        .card.clickable {
            cursor: pointer; /* 一時停止中はクリック可能 */
        }

        .card.flipped {
            transform: rotateY(180deg); /* Y軸を中心に180度回転 */
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari用裏面非表示 */
            backface-visibility: hidden; /* 裏面を非表示 */
            padding: 20px; /* 内側の余白 */
            box-sizing: border-box; /* paddingを含めて計算 */
            border-radius: 16px; /* 角を丸める */
            background: rgba(255, 255, 255, 0.1); /* 半透明の背景 */
            backdrop-filter: blur(10px); /* 背景をぼかす（すりガラス効果） */
            -webkit-backdrop-filter: blur(10px); /* Safari用 */
            border: 1px solid rgba(255, 255, 255, 0.2); /* 枠線 */
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3); /* 影 */
            overflow: hidden; /* 内容がはみ出ないように */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between; /* ★ 上下に配置 */
        }

        /* ★ メインコンテンツ（単語/日本語定義）を中央揃えにするためのラッパー */
        .main-content {
            display: flex;
            flex-direction: column; /* h2/pが縦に並ぶように */
            justify-content: center; /* 垂直中央揃え */
            align-items: center; /* 水平中央揃え */
            flex-grow: 1; /* 利用可能なスペースを埋める */
            width: 100%; /* 幅を100%に */
        }


        .card-front {
            background: linear-gradient(135deg, rgba(36, 123, 205, 0.5), rgba(16, 54, 140, 0.3)); /* 青系のグラデーション */
            color: white;
        }

        .card-back {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.5), rgba(20, 90, 50, 0.3)); /* 緑系のグラデーション */
            color: white;
            transform: rotateY(180deg); /* 最初から裏返しておく */
            display: none; /* 初期状態は非表示 */
        }

        /* カード内のh2 (単語表示) */
        .card h2 {
            margin: 0; /* マージンリセット */
            font-size: 2rem; /* 単語のフォントサイズ */
            font-weight: 600;
            letter-spacing: 1px;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
            background: linear-gradient(to right, #ffffff, #d1d1d1);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center; /* 中央揃え */
            max-width: 100%; /* コンテナからはみ出ないように */
        }

        /* ★ 発音記号のスタイル - Flexアイテムとして配置 */
        .pronunciation {
            width: 90%; /* はみ出し防止 */
            text-align: center;
            font-size: 0.95rem;
            color: white;
            font-weight: 400;
            line-height: 1.4;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
            margin-top: 5px; /* ★ 上の要素との間に少しマージンを追加 */
        }


        /* ページタイトル下のh2 (メインサブタイトル) */
         body > h2#mainSubtitle {
            margin-top:0;
            text-shadow:0 0 5px rgba(255,255,255,0.5);
            font-size:1.2rem;
            font-weight:400;
            margin-bottom: 5px; /* ★ 下のh3との間隔 */
            line-height:1.5;
            text-align:center;
            background: none; /* グラデーション解除 */
             -webkit-background-clip: unset;
             background-clip: unset;
             -webkit-text-fill-color: unset;
             color: white; /* 色を白に戻す */
             min-height: 1.5em; /* テキスト変更時の高さ変動を防ぐ */
        }
        /* ★ 追加: NAWLサブタイトル */
        h3#nawlSubtitle {
            margin: 0 0 10px 0; /* 上下のマージン調整 */
            font-size: 1.0rem; /* 少し小さめに */
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 0 0 3px rgba(255, 255, 255, 0.4);
            text-align: center;
        }


        p { /* 汎用スタイル */
            margin: 5px 0;
            font-size: 18px;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            font-weight: 300; /* 少し細めのフォント */
        }

        /* 裏面テキストの個別スタイル */
        .card-back p.definition-jp {
             max-width: 100%; /* コンテナからはみ出ないように */
            text-align: center; /* 中央揃えは維持 */
            margin: 0; /* マージンリセット */
            font-size: 1.3rem;
            color: #FFD700;
            font-weight: 500;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        }
        /* ★ 英語定義のスタイル - Flexアイテムとして配置 */
        .card-back p.definition-en {
             width: 90%; /* はみ出し防止 */
             text-align: center;
             margin: 0; /* マージンリセット */
             font-size: 0.95rem;
             color: white;
             font-weight: 400;
             line-height: 1.4;
             text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
             margin-top: 5px; /* ★ 上の要素との間に少しマージンを追加 */
        }


        .definition {
            /* スタイルはインラインで指定 */
        }

        .button {
            padding: 12px 24px;
            color: white;
            border: none;
            border-radius: 30px; /* 丸みを帯びたボタン */
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            letter-spacing: 0.5px;
            position: relative; /* :before要素の基準 */
            overflow: hidden; /* :before要素がはみ出ないように */
            transition: all 0.3s ease; /* ホバー効果のトランジション */
            backdrop-filter: blur(5px); /* ボタンの背景ぼかし */
            -webkit-backdrop-filter: blur(5px);
            background: rgba(255, 255, 255, 0.15); /* 半透明背景 */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); /* 影 */
        }

        /* ボタンのホバー時の光沢エフェクト */
        .button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .button:hover:before {
            left: 100%;
        }

        .start-button {
            background: linear-gradient(45deg, rgba(52, 152, 219, 0.8), rgba(41, 128, 185, 0.8)); /* 青系グラデーション */
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 15px; /* カテゴリグリッドとのマージン */
        }

        .start-button:hover {
            background: linear-gradient(45deg, rgba(52, 152, 219, 0.9), rgba(41, 128, 185, 0.9));
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.5); /* ホバー時の光彩効果 */
            transform: translateY(-2px); /* 少し上に移動 */
        }

        /* コントロール内のボタン共通スタイル */
        .control-button {
             color: white;
             border: none;
             border-radius: 20px;
             cursor: pointer;
             transition: all 0.3s ease;
             padding: 6px 12px; /* パディング調整 */
             font-size: 12px;
             text-align: center;
             min-width: 60px; /* 最小幅設定 */
             /* ★ ボタンが均等に広がるように */
             flex-grow: 1;
             flex-basis: 0;
        }

        .prev-button { /* 戻るボタン */
             background: linear-gradient(45deg, #6c757d, #495057); /* グレー系 */
        }
        .prev-button:hover {
             background: linear-gradient(45deg, #868e96, #5a6268);
             transform: translateY(-1px);
             box-shadow: 0 2px 8px rgba(108, 117, 125, 0.4);
        }

        .next-button { /* 小さい方の次へボタン */
            background: linear-gradient(45deg, rgb(39, 174, 96), rgb(27, 120, 66));
        }

        .next-button:hover {
             background: linear-gradient(45deg, rgb(46, 204, 113), rgb(39, 174, 96)); /* ホバー色調整 */
             transform: translateY(-1px);
             box-shadow: 0 2px 8px rgba(46, 204, 113, 0.4);
        }

        .pause-button { /* 小さい方の停止ボタン */
            background: linear-gradient(45deg, rgb(211, 84, 0), rgb(170, 67, 0));
        }

        .pause-button:hover {
            background: linear-gradient(45deg, rgb(243, 156, 18), rgb(211, 84, 0)); /* ホバー色調整 */
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(243, 156, 18, 0.4);
        }
         /* 再生ボタンのスタイル */
         .pause-button.resume {
             background: linear-gradient(45deg, rgb(142, 68, 173), rgb(91, 44, 111));
         }
         .pause-button.resume:hover {
             background: linear-gradient(45deg, rgb(155, 89, 182), rgb(142, 68, 173));
             box-shadow: 0 2px 8px rgba(155, 89, 182, 0.4);
         }


        .progress {
            margin-top: 20px;
            width: 100%;
            text-align: center;
        }

        .hidden {
            display: none !important; /* 確実に非表示にする */
        }

        /* カードカウンターのスタイル調整 */
        .card-counter {
            font-size: 18px;
            margin-top: 10px; /* 上（タイトル）とのマージン */
            margin-bottom: 10px; /* 下（カード）とのマージン */
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
            background: rgba(0, 0, 0, 0.2); /* 半透明背景 */
            padding: 5px 15px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            display: none; /* 初期状態は非表示、JSで表示 */
            width: fit-content;
            text-align: center;
            align-self: center; /* 中央揃え */
            font-family: 'Roboto Mono', monospace;
        }

        /* コントロール要素のコンテナ */
        .control-container {
             display: flex;
             gap: 15px;
             justify-content: center;
             flex-wrap: wrap; /* 幅が足りなければ折り返す */
             margin-top: 15px; /* カードとの間隔 */
             width: 100%;
             max-width: 500px; /* 最大幅 */
        }

        /* 各コントロールパネル（共通） */
        .control-panel {
            text-align: center;
            padding: 10px 15px;
            background: rgba(13, 16, 33, 0.7);
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(55, 75, 110, 0.4);
            display: none; /* 初期状態は非表示、JSで表示 */
            flex-direction: column; /* ラベルとボタンを縦に */
            align-items: center; /* 中央揃え */
            justify-content: center; /* ★ ラベルとボタンを垂直中央揃え */
            flex-grow: 1;
            flex-basis: 0; /* flex-growと合わせて使う */
            min-width: 150px; /* 最小幅を設定して極端に狭くなるのを防ぐ */
            aspect-ratio: 1000 / 618; /* ★ 黄金比を適用 */
        }
        .control-panel .panel-label {
            color: white;
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 500;
            text-align: center;
            width: 100%;
        }
        .control-panel .panel-buttons {
            display: flex;
            justify-content: center; /* 中央揃えに変更 */
            gap: 8px; /* ボタン間のギャップ調整 */
            width: 100%;
        }

        /* 操作ボタンパネル内のボタン */
        #controlBox .panel-buttons button {
             /* 基本スタイルは .control-button で指定 */
        }

        /* 速度ボタン */
        .speed-button {
            background: rgba(86, 101, 115, 0.6);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
             /* ★ 共通スタイルを継承 */
             padding: 6px 12px;
             font-size: 12px;
             text-align: center;
             min-width: 60px;
             flex-grow: 1;
             flex-basis: 0;
        }

        .speed-button:hover {
            background: rgba(128, 140, 141, 0.7);
            transform: translateY(-1px);
        }

        .speed-button.active {
            background: linear-gradient(45deg, rgb(41, 128, 185), rgb(33, 97, 140));
            font-weight: 500;
            box-shadow: 0 0 10px rgba(41, 128, 185, 0.5);
        }

        /* 選択中カテゴリ表示 */
        .category-info {
            margin-top: 20px; /* スタートボタンとのマージン */
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            font-size: 0.9rem;
        }

        /* トップへ戻るボタン */
        .back-button-container {
            margin-top: 20px;
            text-align: center;
        }
        .back-button {
            padding: 8px 20px;
            background: linear-gradient(45deg, rgba(52, 73, 94, 0.8), rgba(44, 62, 80, 0.8));
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            display: none; /* 初期状態は非表示 */
        }
         .back-button:hover {
             background: linear-gradient(45deg, rgba(72, 93, 114, 0.9), rgba(64, 82, 100, 0.9));
             transform: translateY(-1px);
             box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
         }


        /* レスポンシブ対応 */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                min-height: 100vh;
                justify-content: flex-start;
            }

            h1 {
                font-size: 2rem;
                margin-top: 10px;
                margin-bottom: 0;
            }

            body > h2#mainSubtitle {
                font-size: 1.1rem;
                margin-bottom: 3px; /* ★ 調整 */
            }
            h3#nawlSubtitle {
                font-size: 0.9rem; /* ★ 調整 */
                margin-bottom: 8px; /* ★ 調整 */
            }

            .category-grid {
                grid-gap: 10px;
                margin-top: 10px;
                margin-bottom: 15px;
                /* grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); */ /* ★ Tabletでも3列維持 */
            }
            .category-card {
                /* padding: 4px 8px; */ /* ★ 変更前 */
                padding: 16px 8px; /* ★ Tabletでのパディング調整 */
                border-radius: 10px;
            }
             .category-card h3 {
                 /* font-size: 0.9rem; */ /* ★ 変更前 */
                 font-size: 0.9rem; /* ★ Tabletでのフォントサイズ (ベースと同じ) */
                 line-height: 1.2;
             }

             .card-counter {
                 margin-top: 8px;
                 margin-bottom: 8px;
                 font-size: 16px;
                 padding: 4px 12px;
             }

            .card-container {
                width: 90%;
                margin: 8px auto 15px auto;
            }

             .card-front, .card-back {
                 padding: 15px;
             }

             .pronunciation,
             .card-back p.definition-en {
                 font-size: 0.9rem;
                 margin-top: 3px; /* Tabletでのマージン調整 */
             }

             .card-back p.definition-jp {
                 font-size: 1.2rem;
             }
            .card h2 {
                font-size: 1.7rem;
            }


            p { /* カード内のテキストサイズ (汎用) */
                font-size: 15px;
            }

            .button {
                padding: 10px 20px;
                font-size: 15px;
            }
             .start-button {
                 margin-top: 15px;
             }

             .control-container {
                 gap: 10px;
                 margin-top: 10px;
             }
             .control-panel {
                 padding: 8px 12px;
                 min-width: 0; /* ★ 最小幅リセット (Tablet) */
             }
             .control-panel .panel-label { font-size: 13px; }


            .category-info {
                margin-top: 15px;
                font-size: 0.85rem;
            }
            .back-button-container { margin-top: 15px; }
            .back-button { font-size: 13px; padding: 7px 18px; }
        }

        @media (max-width: 480px) {
             body {
                padding: 8px;
            }

            h1 {
                font-size: 1.8rem;
                margin-top: 5px;
            }
             body > h2#mainSubtitle {
                font-size: 1rem;
                margin-bottom: 2px; /* ★ 調整 */
            }
             h3#nawlSubtitle {
                font-size: 0.8rem; /* ★ 調整 */
                margin-bottom: 5px; /* ★ 調整 */
            }

             .category-grid {
                grid-gap: 8px;
                margin-top: 8px;
                margin-bottom: 12px;
                width: 95%;
                grid-template-columns: repeat(2, max-content); /* ★ スマホでは2列 max-content */
             }
            .category-card {
                /* padding: 5px 10px; */ /* ★ 変更前 */
                padding: 20px 10px; /* ★ スマホでのパディング調整 */
                border-radius: 8px;
            }
             .category-card h3 {
                 /* font-size: 0.8rem; */ /* ★ 変更前 */
                 font-size: 0.8rem; /* ★ スマホでのフォントサイズ調整 */
                 line-height: 1.2;
             }

             .card-counter {
                 margin-top: 5px;
                 margin-bottom: 5px;
                 font-size: 14px;
                 padding: 4px 12px;
             }

            .card-container {
                width: 95%;
                margin: 5px auto 10px auto;
            }

             .card-front, .card-back {
                 padding: 10px;
             }
             .pronunciation,
             .card-back p.definition-en {
                 font-size: 0.85rem;
                  margin-top: 2px; /* Mobileでのマージン調整 */
             }

             .card-back p.definition-jp {
                 font-size: 1.1rem;
             }
            .card h2 {
                font-size: 1.5rem;
            }


            .button {
                padding: 8px 16px;
                font-size: 14px;
            }
             .start-button {
                 margin-top: 12px;
             }

             .control-container {
                 gap: 8px;
                 margin-top: 8px;
             }
             .control-panel {
                 padding: 6px 10px;
                 flex-basis: 100%; /* ★ スマホでは各パネルを1行にする */
                 aspect-ratio: auto; /* ★ スマホではアスペクト比を解除 */
             }
              .control-panel .panel-label { font-size: 12px; margin-bottom: 5px; }
              #controlBox .panel-buttons { gap: 8px; }
              #speedControl .panel-buttons { gap: 5px; }


            .category-info {
                margin-top: 12px;
                font-size: 0.8rem;
            }
             .back-button-container { margin-top: 12px; }
             .back-button { font-size: 12px; padding: 6px 15px; }
        }
    </style>
</head>
<body>
    <div class="stars" id="starsContainer"></div>

    <h1>EIGOASOBI</h1>
    <h2 id="mainSubtitle">デジタルフラッシュカード</h2>
    <h3 id="nawlSubtitle">NAWL 957</h3>

    <div class="card-counter" id="cardCounter"></div>

    <div class="category-grid">
         <div class="category-card active" id="category-awl1">
            <h3>Rank 001 - 100</h3> </div>
         <div class="category-card" id="category-awl2">
            <h3>Rank 101 - 200</h3>
        </div>
        <div class="category-card" id="category-awl3">
            <h3>Rank 201 - 300</h3>
        </div>
         <div class="category-card" id="category-awl4">
            <h3>Rank 301 - 400</h3>
        </div>
         <div class="category-card" id="category-awl5">
            <h3>Rank 401 - 500</h3>
        </div>
         <div class="category-card" id="category-awl6">
            <h3>Rank 501 - 600</h3> </div>
        <div class="category-card" id="category-awl7"> <h3>Rank 601 - 700</h3>
        </div>
        <div class="category-card" id="category-awl8"> <h3>Rank 701 - 800</h3>
        </div>
        <div class="category-card" id="category-awl9"> <h3>Rank 801 - 900</h3>
        </div>
        <div class="category-card" id="category-awl10">
            <h3>Rank 901 - 957</h3> </div>
    </div>

    <div class="card-container hidden" id="cardContainer">
        <div class="card" id="currentCard">
            <div class="card-front" id="cardFront">
                </div>
            <div class="card-back" id="cardBack">
                 </div>
        </div>
    </div>

    <div class="control-container">
        <div class="control-panel" id="controlBox">
            <div class="panel-label">コントロール</div>
            <div class="panel-buttons">
                 <button class="control-button pause-button" id="pauseButtonSmall">停止</button>
                <button class="control-button prev-button" id="prevButtonSmall">戻る</button>
                <button class="control-button next-button" id="nextButtonSmall">次へ</button>
            </div>
        </div>

        <div class="control-panel" id="speedControl">
            <div class="panel-label">表示速度</div>
            <div class="panel-buttons">
                <button class="speed-button active" id="speed2s">２秒</button>
                <button class="speed-button" id="speed1s">１秒</button>
                <button class="speed-button" id="speed0_5s">０.５秒</button>
            </div>
        </div>
    </div>

    <button class="button start-button" id="startButton">スタート</button>

    <div class="category-info" id="categoryInfo">
         選択中: <span id="selectedCategoryText">Rank 001 - 100</span> </div>

    <div class="back-button-container">
        <button class="back-button" id="backButton">トップ画面に戻る</button>
    </div>

    <script>
        // 星空エフェクトを生成する関数
        function createStars() {
            const starsContainer = document.getElementById('starsContainer');
            if (!starsContainer) return; // 要素チェック追加
            const isMobile = window.innerWidth <= 768 || 'ontouchstart' in window;
            let starsCount;
            if (isMobile) {
                starsCount = window.innerWidth < 480 ? 50 : 80;
            } else {
                starsCount = 150;
            }
            starsContainer.innerHTML = '';
            for (let i = 0; i < starsCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                const size = isMobile ? Math.random() * 1.5 + 0.5 : Math.random() * 2 + 1;
                const left = Math.random() * 100;
                const top = Math.random() * 100;
                const duration = isMobile ? 3 + Math.random() * 5 : 4 + Math.random() * 8;
                const delay = Math.random() * 5;
                const opacity = 0.3 + Math.random() * 0.7;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${left}%`;
                star.style.top = `${top}%`;
                star.style.setProperty('--duration', `${duration}s`);
                star.style.setProperty('--opacity', opacity);
                star.style.animationDelay = `${delay}s`;
                starsContainer.appendChild(star);
            }
        }
        window.addEventListener('load', createStars);
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                 const starsContainer = document.getElementById('starsContainer');
                 if (starsContainer) {
                    starsContainer.innerHTML = '';
                    createStars();
                 }
            }, 250);
        });

        // カードデータ
        const cards = [
             { front: { word: "repertoire" }, back: { pronunciation: "ˈrɛp.ərˌtwɑr", definition_jp: "スキルや技能の集合", definition_en: "スキルや業績のコレクション" } },
             { front: { word: "obtain" }, back: { pronunciation: "əbˈteɪn", definition_jp: "手に入れる", definition_en: "得る" } },
             { front: { word: "distribution" }, back: { pronunciation: "ˌdɪs.trəˈbju.ʃən", definition_jp: "分布", definition_en: "物事が特定の地域やグループに広がっている方法" } },
             { front: { word: "parameter" }, back: { pronunciation: "pəˈræm.ɪ.tər", definition_jp: "パラメータ", definition_en: "特性や一定の要素、限界" } },
             { front: { word: "aspect" }, back: { pronunciation: "ˈæs.pɛkt", definition_jp: "側面", definition_en: "特質、部分、または要素" } },
             { front: { word: "dynamic" }, back: { pronunciation: "daɪˈnæ.mɪk", definition_jp: "動的な", definition_en: "常に活動している、または変化している；物理学では：運動に関連する力" } },
             { front: { word: "impact" }, back: { pronunciation: "ˈɪm.pækt", definition_jp: "影響", definition_en: "衝撃的な効果や結果（動詞）力強く打つ" } },
             { front: { word: "domain" }, back: { pronunciation: "doʊˈmeɪn", definition_jp: "領域", definition_en: "行動、思考、または影響の分野；知識の領域" } },
             { front: { word:"publish" }, back: { pronunciation: "ˈpʌb.lɪʃ", definition_jp: "出版する", definition_en: "本、雑誌、またはオンラインで印刷する" } },
             { front: { word: "denote" }, back: { pronunciation: "dɪˈnoʊt", definition_jp: "示す", definition_en: "何かの名前や記号になる" } },
             { front: { word: "authority" }, back: { pronunciation: "əˈθɔr.ɪ.ti", definition_jp: "権威", definition_en: "権力を持つ人々；ほとんどの人に受け入れられている専門家の見解" } },
             { front: { word: "semantic" }, back: { pronunciation: "sɪˈmæn.tɪk", definition_jp: "意味論的な", definition_en: "言葉の異なる意味" } },
             { front: { word: "par" }, back: { pronunciation: "pɑr", definition_jp: "同等", definition_en: "通常の量" } },
             { front: { word: "ion" }, back: { pronunciation: "ˈaɪ.ɒn", definition_jp: "イオン", definition_en: "帯電した原子" } },
             { front: { word: "matrix" }, back: { pronunciation: "ˈmeɪ.trɪks", definition_jp: "母体、行列", definition_en: "物質、状況、または環境で、何かがその起源を持つ場所 - 数学では：行と列の数字の配置" } },
             { front: { word: "linear" }, back: { pronunciation: "ˈlɪn.i.ər", definition_jp: "線形の", definition_en: "線で構成された" } },
             { front: { word: "cognitive" }, back: { pronunciation: "ˈkɒg.nɪ.tɪv", definition_jp: "認知的な", definition_en: "知識を得て記憶するプロセス" } },
             { front: { word: "graph" }, back: { pronunciation: "græf,.grɑf", definition_jp: "グラフ", definition_en: "変数間の関係を示す図表" } },
             { front: { word: "correlation" }, back: { pronunciation: "ˌkɔr.əˈleɪ.ʃən", definition_jp: "相関", definition_en: "2つの変数間の関係の尺度" } },
             { front: { word: "linguistic" }, back: { pronunciation: "lɪŋˈgwɪs.tɪk", definition_jp: "言語の", definition_en: "言語に属する" } },
             { front: { word: "acid" }, back: { pronunciation: "ˈæs.ɪd", definition_jp: "酸", definition_en: "酸味があり、金属や炭酸塩と反応し、青色リトマス紙を赤く変える物質。例：レモン汁" } },
             { front: { word: "induce" }, back: { pronunciation: "ɪn.djus", definition_jp: "誘発する", definition_en: "引き起こす、説得する" } },
             { front: { word: "velocity" }, back: { pronunciation: "vəˈlɒs.ɪ.ti", definition_jp: "速度", definition_en: "特定の方向への速度" } },
             { front: { word: "interval" }, back: { pronunciation: "ˈɪn.tər.vəl", definition_jp: "間隔", definition_en: "2点、数字、または時間の間の距離" } },
             { front: { word: "discourse" }, back: { pronunciation: "ˈdɪs.kɔrs", definition_jp: "談話", definition_en: "会話、対話" } },
             { front: { word: "finite" }, back: { pronunciation: "ˈfaɪ.naɪt", definition_jp: "有限の", definition_en: "限界がある；限られた時間続く" } },
             { front: { word: "stimulus" }, back: { pronunciation: "stɪmyələs", definition_jp: "刺激", definition_en: "変化を起こすもの" } },
             { front: { word: "vector" }, back: { pronunciation: "ˈvɛk.tər", definition_jp: "ベクトル", definition_en: "大きさと方向の両方を持つ量" } },
             { front: { word: "electron" }, back: { pronunciation: "ɪˈlɛk.trɒn", definition_jp: "電子", definition_en: "負に帯電した粒子" } },
             { front: { word: "receptor" }, back: { pronunciation: "rɪˈsɛp.tər", definition_jp: "受容体", definition_en: "情報を受け取る装置" } },
             { front: { word: "theorem" }, back: { pronunciation: "ˈθɪər.əm", definition_jp: "定理", definition_en: "証明できる声明" } },
             { front: { word: "algorithm" }, back: { pronunciation: "ˈæl.gəˌrɪð.əm", definition_jp: "アルゴリズム", definition_en: "問題解決を保証する論理的なルールや手順" } },
             { front: { word: "fluid" }, back: { pronunciation: "ˈflu.ɪd", definition_jp: "流体", definition_en: "簡単に流れることができる物質。例：水" } },
             { front: { word: "developmental" }, back: { pronunciation: "dɪˈvɛl.əp.mənt", definition_jp: "発達の", definition_en: "物事や人の発展や成長に関する" } },
             { front: { word: "bound" }, back: { pronunciation: "baʊnd", definition_jp: "縛られた、跳ぶ", definition_en: "特定の場所に行く；ジャンプする" } },
             { front: { word: "molecular" }, back: { pronunciation: "məˈlɛk.jə.lər", definition_jp: "分子の", definition_en: "結合された原子に関するまたは原子によって引き起こされる" } },
             { front: { word: "transformation" }, back: { pronunciation: "ˌtræns.fərˈmeɪ.ʃən", definition_jp: "変換", definition_en: "変化" } },
             { front: { word: "spatial" }, back: { pronunciation: "ˈspeɪ.ʃəl", definition_jp: "空間の", definition_en: "空間に関する" } },
             { front: { word: "coefficient" }, back: { pronunciation: "ˌkoʊ.əˈfɪʃ.ənt", definition_jp: "係数", definition_en: "数学的表現における変数に掛けられる数字" } },
             { front: { word: "translation" }, back: { pronunciation: "trænzleɪʃən", definition_jp: "翻訳、並進", definition_en: "ある形から別の形に変わること。例：ある言語から別の言語への変換" } },
             { front: { word: "membrane" }, back: { pronunciation: "ˈmɛm.breɪn", definition_jp: "膜", definition_en: "薄い組織のカバー" } },
             { front: { word: "neuron" }, back: { pronunciation: "ˈnʊər.ɒn", definition_jp: "ニューロン", definition_en: "神経細胞；神経系の基本的な構成要素" } },
             { front: { word: "simulation" }, back: { pronunciation: "ˌsɪm.jəˈleɪ.ʃən", definition_jp: "シミュレーション", definition_en: "コピー；実世界の特性を研究・分析するための方法" } },
             { front: { word: "lexical" }, back: { pronunciation: "ˈlɛk.sɪ.kəl", definition_jp: "語彙的な", definition_en: "言葉に関する" } },
             { front: { word: "regime" }, back: { pronunciation: "rəˈʒim", definition_jp: "体制", definition_en: "管理システム；政府の形態" } },
             { front: { word: "variance" }, back: { pronunciation: "ˈvɛər.i.əns", definition_jp: "差異、分散", definition_en: "差の量；分布の変動性を測る統計値" } },
             { front: { word: "molecule" }, back: { pronunciation: "ˈmɒl.əˌkjul", definition_jp: "分子", definition_en: "化学的に結合した2つ以上の原子" } },
             { front: { word: "marker" }, back: { pronunciation: "ˈmɑr.kər", definition_jp: "標識", definition_en: "認識や識別が容易なもの" } },
             { front: { word: "empirical" }, back: { pronunciation: "ɛmˈpɪr.ɪ.kəl", definition_jp: "経験的な", definition_en: "観察や実験に基づく" } },
             { front: { word: "robot" }, back: { pronunciation: "ˈroʊ.bɒt", definition_jp: "ロボット", definition_en: "人間のように行動する機械的な生き物" } },
             { front: { word: "statistical" }, back: { pronunciation: "stəˈtɪs.tɪ.kəl", definition_jp: "統計的な", definition_en: "情報を表す数字に関する" } },
             { front: { word: "vowel" }, back: { pronunciation: "ˈvaʊ.əl", definition_jp: "母音", definition_en: "音声；a、e、i、o、u、時にはyも含む" } },
             { front: { word: "equilibrium" }, back: { pronunciation: "ˌi.kwəˈlɪb.ri.əm", definition_jp: "平衡", definition_en: "バランスの状態" } },
             { front: { word: "intensity" }, back: { pronunciation: "ɪnˈtɛn.sɪ.ti", definition_jp: "強度", definition_en: "大きなエネルギー、強さ、集中；物理学では：強度＝パワー／単位面積" } },
             { front: { word: "regression" }, back: { pronunciation: "rɪˈgrɛʃ.ən", definition_jp: "回帰", definition_en: "後戻り；統計学では：結果の値を別の変数との相関に基づいて予測することに焦点を当てた相関手続きの一種" } },
             { front: { word: "diagnosis" }, back: { pronunciation: "ˌdaɪ.əgˈnoʊ.sɪs", definition_jp: "診断", definition_en: "検査結果に基づく専門家による決定" } },
             { front: { word: "identification" }, back: { pronunciation: "ɪˌdɛn.tɪ.fɪˈkeɪ.ʃən", definition_jp: "識別、同定", definition_en: "識別された状態；人を識別するもの" } },
             { front: { word: "node" }, back: { pronunciation: "noʊd", definition_jp: "節点", definition_en: "ネットワーク内の交差点や接合点；植物で新しい葉が生えるところ" } },
             { front: { word: "partial" }, back: { pronunciation: "pɑrʃəl", definition_jp: "部分的な", definition_en: "不完全；一方の側を他方より好む" } },
             { front: { word: "correlate" }, back: { pronunciation: "ˈkɔr.əˌleɪt", definition_jp: "相関する", definition_en: "2つのアイテムまたはイベント間の関係を示す" } },
             { front: { word: "mortality" }, back: { pronunciation: "mɔrˈtæl.ɪ.ti", definition_jp: "死亡率", definition_en: "人間であり死ぬことができる性質や状態" } },
             { front: { word: "antibody" }, back: { pronunciation: "ˈæn.tɪˌbɒd.i", definition_jp: "抗体", definition_en: "病気に対する体が提供する防御" } },
             { front: { word: "temporal" }, back: { pronunciation: "ˈtɛm.pər.əl", definition_jp: "時間の、側頭部の", definition_en: "時間に関する" } },
             { front: { word: "particle" }, back: { pronunciation: "ˈpɑr.tɪ.kəl", definition_jp: "粒子", definition_en: "非常に小さな何かの一部" } },
             { front: { word: "duration" }, back: { pronunciation: "dʊˈreɪ.ʃən", definition_jp: "持続時間", definition_en: "あるものが続く時間の長さ" } },
             { front: { word: "behavioral" }, back: { pronunciation: "bɪˈheɪv.jər.əl", definition_jp: "行動の", definition_en: "行動の仕方に関する" } },
             { front: { word: "consumption" }, back: { pronunciation: "kənsʌmpʃən", definition_jp: "消費、摂取", definition_en: "物事にかけるお金の量；食べたり飲んだりするプロセス" } },
             { front: { word: "bilingual" }, back: { pronunciation: "baɪˈlɪŋ.gwəl", definition_jp: "バイリンガル", definition_en: "2つの言語を話す人" } },
             { front: { word: "sensitivity" }, back: { pronunciation: "ˌsɛn.sɪˈtɪv.ɪ.ti", definition_jp: "感受性", definition_en: "敏感であること；生理学では：生物またはその一部が刺激に反応する能力；電子工学では：ラジオ機器が着信信号に反応する能力" } },
             { front: { word: "similarity" }, back: { pronunciation: "sˌɪməlɛrəti", definition_jp: "類似性", definition_en: "人や物事が同じである程度" } },
             { front: { word: "optimal" }, back: { pronunciation: "ˈɒp.tə.məl", definition_jp: "最適な", definition_en: "最良" } },
             { front: { word: "explicit" }, back: { pronunciation: "ɪkˈsplɪs.ɪt", definition_jp: "明白な", definition_en: "明確な、はっきりと述べられた" } },
             { front: { word: "mutation" }, back: { pronunciation: "mjuˈteɪ.ʃən", definition_jp: "突然変異", definition_en: "変化；遺伝学では：遺伝構造を変える出来事" } },
             { front: { word: "colonial" }, back: { pronunciation: "kəˈloʊ.ni.əl", definition_jp: "植民地の", definition_en: "集団で生活することに関する" } },
             { front: { word: "spectrum" }, back: { pronunciation: "ˈspɛk.trəm", definition_jp: "スペクトル", definition_en: "赤から紫までの色の波長" } },
             { front: { word: "phonological" }, back: { pronunciation: "ˌfoʊn.lˈɒdʒ.ɪ.kəl", definition_jp: "音韻論的な", definition_en: "音に関する" } },
             { front: { word: "nucleus" }, back: { pronunciation: "ˈnu.kli.əs", definition_jp: "核", definition_en: "細胞の制御中心" } },
             { front: { word: "onset" }, back: { pronunciation: "ɑn.sɛt", definition_jp: "開始", definition_en: "始まり" } },
             { front: { word: "integration" }, back: { pronunciation: "ˌɪn.tɪˈgreɪ.ʃən", definition_jp: "統合", definition_en: "物事を全体としてまとめること" } },
             { front: { word: "dominant" }, back: { pronunciation: "ˈdɒm.ə.nənt", definition_jp: "支配的な", definition_en: "最強" } },
             { front: { word: "pathway" }, back: { pronunciation: "ˈpæθˌweɪ", definition_jp: "経路", definition_en: "経路；生化学では：反応の連鎖" } },
             { front: { word: "coordinate" }, back: { pronunciation: "koʊˈɔr.dnˌeɪt", definition_jp: "調整する、座標", definition_en: "何かに秩序と組織をもたらす；（名）数学では：固定図形または線のシステムを参照して点または線の位置を定義するのに役立つ大きさ" } },
             { front: { word: "calculation" }, back: { pronunciation: "kˌælkyəleɪʃən", definition_jp: "計算", definition_en: "合計の答え；計算する行為" } },
             { front: { word: "precede" }, back: { pronunciation: "prɪˈsid", definition_jp: "先行する", definition_en: "先行する" } },
             { front: { word: "subset" }, back: { pronunciation: "ˈsʌbˌsɛt", definition_jp: "部分集合", definition_en: "より大きな集合の一部である小さな集合" } },
             { front: { word: "syntactic" }, back: { pronunciation: "sɪnˈtæk.tɪk", definition_jp: "統語的な", definition_en: "文法的" } },
             { front: { word: "orientation" }, back: { pronunciation: "ˌɔr.i.ənˈteɪ.ʃən", definition_jp: "方向感覚、オリエンテーション", definition_en: "時間、場所、人々を参照して自分の環境内で自分自身を位置づける能力" } },
             { front: { word: "proposition" }, back: { pronunciation: "ˌprɒp.əˈzɪʃ.ən", definition_jp: "命題、提案", definition_en: "アイデア；提案" } },
             { front: { word: "inequality" }, back: { pronunciation: "ˌɪn.ɪˈkwɒl.ɪ.ti", definition_jp: "不平等、不等式", definition_en: "同じではない；数学では：<、>、=、≠、または？を使用して2つの量を比較する文" } },
             { front: { word: "identical" }, back: { pronunciation: "aɪˈdɛn.tɪ.kəl", definition_jp: "同一の", definition_en: "あらゆる面で同じ" } },
             { front: { word: "prevalence" }, back: { pronunciation: "ˈprɛv.ə.ləns", definition_jp: "普及", definition_en: "広く普及している、一般的な" } },
             { front: { word: "differential" }, back: { pronunciation: "ˌdɪf.əˈrɛn.ʃəl", definition_jp: "差", definition_en: "違い；多様性" } },
             { front: { word: "generalize" }, back: { pronunciation: "ˈdʒɛn.ər.əˌlaɪz", definition_jp: "一般化する", definition_en: "事実から共通の考えや結論を導き出す" } },
             { front: { word: "beam" }, back: { pronunciation: "bim", definition_jp: "梁、光線", definition_en: "金属や木の長い部分；光やエネルギーの線" } },
             { front: { word: "pulse" }, back: { pronunciation: "pʌls", definition_jp: "脈拍", definition_en: "心臓の鼓動" } },
             { front: { word: "norm" }, back: { pronunciation: "nɔrm", definition_jp: "基準", definition_en: "パフォーマンスや行動の確立された基準" } },
             { front: { word: "trait" }, back: { pronunciation: "treɪt", definition_jp: "特徴", definition_en: "特徴" } },
             { front: { word: "prediction" }, back: { pronunciation: "prɪˈdɪk.ʃən", definition_jp: "予測", definition_en: "これから起こることの声明" } },
             { front: { word: "correspondence" }, back: { pronunciation: "ˌkɔr.əˈspɒn.dəns", definition_jp: "通信、一致", definition_en: "文章による通信；類似性" } },
             { front: { word: "essentially" }, back: { pronunciation: "ɪˈsɛnʃəlɪ", definition_jp: "本質的に", definition_en: "基本的に、主に" } },
        ];

        // DOM要素の取得
        const getElement = (id) => document.getElementById(id);
        const cardContainer = getElement('cardContainer');
        const currentCard = getElement('currentCard');
        const cardFront = getElement('cardFront');
        const cardBack = getElement('cardBack');
        const startButton = getElement('startButton');
        const cardCounter = getElement('cardCounter');
        const speedControl = getElement('speedControl');
        const speed2sButton = getElement('speed2s');
        const speed1sButton = getElement('speed1s');
        const speed0_5sButton = getElement('speed0_5s');
        const controlBox = getElement('controlBox');
        const prevButtonSmall = getElement('prevButtonSmall');
        const nextButtonSmall = getElement('nextButtonSmall');
        const pauseButtonSmall = getElement('pauseButtonSmall');
        const backButton = getElement('backButton');
        const categoryGrid = document.querySelector('.category-grid');
        const categoryInfo = getElement('categoryInfo');
        const selectedCategoryText = getElement('selectedCategoryText');
        const categoryCards = document.querySelectorAll('.category-card');
        const mainSubtitle = getElement('mainSubtitle');
        const nawlSubtitle = getElement('nawlSubtitle');

        // 状態変数
        let currentCardIndex = 0;
        let autoFlipTimer = null;
        let autoNextTimer = null;
        let isPaused = false;
        let flipDelay = 2000;
        let autoAdvance = true;
        let currentRankInfo = '';

        // カードの表示を更新する関数
        function showCardFront(index) {
             if (!cards || index < 0 || index >= cards.length) return;
            const card = cards[index];
            if (!cardFront || !cardBack || !cardCounter || !currentCard) return;

            // ★ HTML構造を変更：メインコンテンツをラッパーで囲む
            cardFront.innerHTML = `
                <div class="main-content">
                    <h2>${card.front.word}</h2>
                </div>
                <span class="pronunciation">${card.back.pronunciation}</span>
            `;
            cardBack.innerHTML = `
                 <div class="main-content">
                    <p class="definition-jp">${card.back.definition_jp}</p>
                 </div>
                 <p class="definition-en">${card.back.definition_en}</p>
            `;

            // カード番号の更新
            cardCounter.innerHTML = `<span style="margin-right: 5px;">Rank</span><span id="rank-value-span" style="font-family: 'Roboto Mono', monospace; min-width: 40px; display: inline-block; text-align: right;">${(index + 1).toString().padStart(3, '0')}</span><span> / ${cards.length}</span>`;

            // カード裏面を非表示に設定
            if (cardBack) cardBack.style.display = 'none';

            // カードを表面に戻す
            currentCard.classList.remove('flipped');
            void currentCard.offsetHeight; // 強制リフロー

            // 一時停止状態に応じてクリック可能クラスを制御
             if (currentCard) {
                 currentCard.classList.toggle('clickable', isPaused);
             }

            // 自動進行タイマーの設定
            if (autoAdvance && !isPaused) {
                clearTimeout(autoFlipTimer);
                clearTimeout(autoNextTimer);
                autoFlipTimer = setTimeout(() => {
                    if (!isPaused && currentCard && cardBack) {
                        cardBack.style.display = 'flex'; // 裏面を表示
                        currentCard.classList.add('flipped'); // 回転
                        autoNextTimer = setTimeout(nextCard, flipDelay); // 次のカードへ
                    }
                }, flipDelay);
            }
        }

        // 次のカードへ
        function nextCard() {
            clearTimeout(autoFlipTimer);
            clearTimeout(autoNextTimer);
            currentCardIndex = (currentCardIndex + 1) % cards.length;
            showCardFront(currentCardIndex);
        }

        // 前のカードへ
        function prevCard() {
            isPaused = true;
            if (pauseButtonSmall) {
                pauseButtonSmall.textContent = '再生';
                pauseButtonSmall.classList.add('resume');
            }
            if (currentCard) currentCard.classList.add('clickable');
            clearTimeout(autoFlipTimer);
            clearTimeout(autoNextTimer);
            currentCardIndex--;
            if (currentCardIndex < 0) {
                currentCardIndex = cards.length - 1;
            }
            showCardFront(currentCardIndex);
        }

        // 表示速度の設定
        function setSpeed(seconds) {
            flipDelay = seconds * 1000;
            [speed2sButton, speed1sButton, speed0_5sButton].forEach(btn => {
                if(btn) btn.classList.remove('active');
            });
            let activeButton;
            if (seconds === 2) activeButton = speed2sButton;
            else if (seconds === 1) activeButton = speed1sButton;
            else if (seconds === 0.5) activeButton = speed0_5sButton;
            if(activeButton) activeButton.classList.add('active');
            if (!isPaused) {
                clearTimeout(autoFlipTimer);
                clearTimeout(autoNextTimer);
                showCardFront(currentCardIndex);
            }
        }

        // UI表示切り替え
        function showFlashcardView(show) {
             const displayGrid = show ? 'none' : 'grid';
             const displayApp = show ? 'block' : 'none';
             const displayFlexApp = show ? 'flex' : 'none';
             if (categoryGrid) categoryGrid.style.display = displayGrid;
             if (categoryInfo) categoryInfo.style.display = show ? 'none' : 'block';
             if (startButton) startButton.classList.toggle('hidden', show);
             if (cardContainer) cardContainer.classList.toggle('hidden', !show);
             if (cardCounter) cardCounter.style.display = show ? 'inline-block' : 'none';
             if (controlBox) controlBox.style.display = displayFlexApp;
             if (speedControl) speedControl.style.display = displayFlexApp;
             if (backButton) backButton.style.display = show ? 'inline-block' : 'none';
             if (mainSubtitle && nawlSubtitle) {
                 if (show) {
                     mainSubtitle.textContent = nawlSubtitle.textContent;
                     nawlSubtitle.style.display = 'none';
                 } else {
                     mainSubtitle.textContent = 'デジタルフラッシュカード';
                     nawlSubtitle.style.display = 'block';
                 }
             }
        }

        // 選択中カテゴリ情報の設定
        function setActiveCategoryInfo() {
            const activeCard = document.querySelector('.category-card.active');
            if (activeCard) {
                currentRankInfo = activeCard.querySelector('h3')?.textContent || '';
                 // ★ 初期選択カテゴリ表示も 0 埋めを反映
                if (currentRankInfo === 'Rank 1 - 100') {
                    currentRankInfo = 'Rank 001 - 100';
                }
                if(selectedCategoryText) selectedCategoryText.textContent = currentRankInfo;
            }
        }
        setActiveCategoryInfo(); // 初期読み込み

        // イベントリスナー
        if (startButton) {
            startButton.addEventListener('click', () => {
                setActiveCategoryInfo();
                showFlashcardView(true);
                currentCardIndex = 0;
                isPaused = false;
                if (pauseButtonSmall) {
                    pauseButtonSmall.textContent = '停止';
                    pauseButtonSmall.classList.remove('resume');
                }
                setSpeed(flipDelay / 1000);
                showCardFront(currentCardIndex);
                if (currentCard) {
                    currentCard.removeEventListener('click', handleCardClick);
                    currentCard.addEventListener('click', handleCardClick);
                }
            });
        }
        if (backButton) {
            backButton.addEventListener('click', () => {
                showFlashcardView(false);
                clearTimeout(autoFlipTimer);
                clearTimeout(autoNextTimer);
                isPaused = true;
                if (currentCard) {
                    currentCard.removeEventListener('click', handleCardClick);
                }
            });
        }
        function handleCardClick() { // 手動フリップ
            if (isPaused && currentCard && cardBack) {
                if (currentCard.classList.contains('flipped')) {
                    currentCard.classList.remove('flipped');
                    setTimeout(() => {
                         if (cardBack) cardBack.style.display = 'none';
                    }, 500); // アニメーション後に非表示
                } else {
                    cardBack.style.display = 'flex'; // 表示してから回転
                    currentCard.classList.add('flipped');
                }
            }
        }
        if (prevButtonSmall) prevButtonSmall.addEventListener('click', prevCard);
        if (nextButtonSmall) {
            nextButtonSmall.addEventListener('click', () => {
                 isPaused = true;
                 if (pauseButtonSmall) {
                     pauseButtonSmall.textContent = '再生';
                     pauseButtonSmall.classList.add('resume');
                 }
                 if (currentCard) currentCard.classList.add('clickable');
                 clearTimeout(autoFlipTimer);
                 clearTimeout(autoNextTimer);
                 nextCard();
            });
        }
        if (pauseButtonSmall) {
            pauseButtonSmall.addEventListener('click', () => {
                isPaused = !isPaused;
                if (isPaused) {
                    clearTimeout(autoFlipTimer);
                    clearTimeout(autoNextTimer);
                    pauseButtonSmall.textContent = '再生';
                    pauseButtonSmall.classList.add('resume');
                    if (currentCard) currentCard.classList.add('clickable');
                } else {
                    pauseButtonSmall.textContent = '停止';
                    pauseButtonSmall.classList.remove('resume');
                    if (currentCard) currentCard.classList.remove('clickable');
                    if (currentCard && currentCard.classList.contains('flipped')) {
                         autoNextTimer = setTimeout(nextCard, flipDelay);
                    } else {
                         showCardFront(currentCardIndex); // タイマー再開
                    }
                }
            });
        }
        if (speed2sButton) speed2sButton.addEventListener('click', () => setSpeed(2));
        if (speed1sButton) speed1sButton.addEventListener('click', () => setSpeed(1));
        if (speed0_5sButton) speed0_5sButton.addEventListener('click', () => setSpeed(0.5));
        categoryCards.forEach(card => {
             if (!card) return;
            card.addEventListener('click', () => {
                categoryCards.forEach(c => { if(c) c.classList.remove('active'); });
                 card.classList.add('active');
                 setActiveCategoryInfo();
                 // TODO: カテゴリに応じたデータ読み込み処理
            });
        });
         let cardResizeTimer; // リサイズ時の再描画
         window.addEventListener('resize', () => {
             if (cardContainer && !cardContainer.classList.contains('hidden')) {
                 clearTimeout(cardResizeTimer);
                 cardResizeTimer = setTimeout(() => {
                     showCardFront(currentCardIndex);
                     if (currentCard && currentCard.classList.contains('flipped')) {
                         currentCard.classList.remove('flipped');
                         void currentCard.offsetHeight;
                         cardBack.style.display = 'flex';
                         currentCard.classList.add('flipped');
                     } else if (cardBack) {
                         cardBack.style.display = 'none';
                     }
                 }, 250);
             }
         });
    </script>
</body>
</html>
