<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英語学習フラッシュカード</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&display=swap" rel="stylesheet">
    <style>
        /* 基本的な body スタイル */
        body {
            font-family: 'Montserrat', 'Helvetica Neue', Arial, sans-serif; /* フォント設定 */
            margin: 0; /* マージン削除 */
            padding: 15px; /* 内側余白 */
            display: flex; /* Flexbox レイアウト */
            flex-direction: column; /* 縦方向 */
            align-items: center; /* 中央揃え */
            justify-content: flex-start; /* コンテンツを上部に配置 */
            min-height: 100vh; /* 画面の高さいっぱいに表示 */
            height: 100%; /* スクロールバー対策 */
            background: #000; /* フォールバック背景色 */
            color: white; /* 文字色 */
            overflow-x: hidden; /* 横スクロールバーを防止 */
            position: relative; /* 背景要素の基準点 */
            box-sizing: border-box; /* paddingを含めて計算 */
        }

        /* 銀河背景のアニメーション */
        body:before {
            content: "";
            position: fixed; /* 背景を固定 */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(125deg, #090e29, #020024, #1e0a3d, #09244c); /* グラデーション背景 */
            background-size: 400% 400%; /* アニメーションのために拡大 */
            z-index: -2; /* コンテンツの下に配置 */
            animation: galaxyMove 20s ease infinite; /* アニメーション適用 */
        }

        /* 星のきらめき効果用コンテナ */
        .stars {
            position: fixed; /* 星を固定 */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* クリックイベントを無効化 */
            z-index: -1; /* 背景とコンテンツの間に配置 */
        }

        /* 個々の星のスタイル */
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            /* アニメーションのプロパティをCSS変数で設定 */
            animation: twinkle var(--duration) ease-in-out infinite;
            opacity: var(--opacity); /* 初期透明度 */
        }

        /* 背景グラデーションのアニメーション */
        @keyframes galaxyMove {
            0% { background-position: 0% 50% }
            50% { background-position: 100% 50% }
            100% { background-position: 0% 50% }
        }

        /* 星の瞬きアニメーション */
        @keyframes twinkle {
            0%, 100% {
                opacity: var(--opacity); /* 開始/終了時は基本の透明度 */
                transform: scale(1);
            }
            20% {
                opacity: calc(var(--opacity) * 0.6); /* 少し暗く、小さく */
                transform: scale(0.9);
            }
            50% {
                 opacity: calc(var(--opacity) * 0.95); /* やや明るく、大きく */
                 transform: scale(1.05);
            }
             80% {
                 opacity: calc(var(--opacity) * 0.5); /* 再び暗く */
                 transform: scale(0.95);
             }
        }

        /* メインタイトル (H1) */
        h1 {
            font-weight: 600;
            margin: 10px 0 5px; /* 上下のマージン調整 */
            color: #ffffff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.7), 0 0 20px rgba(255, 255, 255, 0.5); /* テキストシャドウ */
            font-size: 2.2rem; /* フォントサイズ */
            letter-spacing: 1px; /* 文字間隔 */
            display: flex; /* 絵文字の垂直中央揃えのため */
            align-items: center; /* 絵文字の垂直中央揃えのため */
            justify-content: center; /* 全体を中央揃え */
        }
        /* 絵文字用のスタイル */
        h1 span {
             vertical-align: middle; /* 垂直位置の微調整 */
             display: inline-block;
        }


        /* カテゴリ選択グリッド */
        .category-grid {
             display: grid;
             grid-template-columns: repeat(3, 1fr); /* 3カラム均等割り (デフォルト) */
             justify-content: center;
             grid-gap: 15px;
             margin: 15px auto 20px auto;
             width: 95%;
             max-width: 800px;
        }

        /* カテゴリカードの共通スタイル */
        .category-card {
            background: linear-gradient(135deg, rgba(36, 123, 205, 0.3), rgba(16, 54, 140, 0.2));
            padding: 12px 18px; /* 横長のパディング */
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 55px; /* 最小高さ */
        }

        /* カテゴリカード内のランク表示 (H3) */
        .category-card h3 {
            margin: 0;
            font-size: 0.85rem;
            color: white;
            font-weight: 500;
            line-height: 1.15;
            width: 100%;
        }
        /* Rankラベル用のスタイル */
        .rank-label {
            display: block;
            font-size: 0.8em; /* 変更済み */
            font-weight: 400;
            margin-bottom: 1px;
        }
        /* Rank範囲用のスタイル */
        .rank-range {
            display: block;
            font-size: 1.0em; /* 変更済み */
            font-weight: 500;
        }


        /* 準備中テキストのスタイル */
        .status-preparing {
            font-size: 0.6rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 3px;
            margin-bottom: 0;
            width: 100%;
        }

        /* 無効なカテゴリカードのスタイル */
        .category-disabled {
            opacity: 0.6; /* 半透明に */
            cursor: not-allowed; /* カーソル変更 */
        }
        /* 無効なカードホバー時の効果を抑制 */
        .category-disabled:hover {
             border: 1px solid rgba(255, 255, 255, 0.1);
             box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* 選択中のカテゴリカード */
        .category-card.active {
             border: 2px solid rgba(52, 152, 219, 0.6); /* 強調ボーダー */
             box-shadow: 0 0 10px rgba(52, 152, 219, 0.3); /* 軽い光彩 */
        }
        /* 無効なカードが選択されても見た目は通常通り */
        .category-disabled.active {
             border: 1px solid rgba(255, 255, 255, 0.1);
             box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* カードコンテナ */
        .card-container {
            width: 90%; /* 幅を画面比率で設定 */
            max-width: 400px; /* 最大幅を設定 */
            aspect-ratio: 1000 / 618; /* 黄金比 (横長) */
            perspective: 1500px; /* 3D効果の奥行き */
            margin: 10px auto 20px auto; /* 上下マージン調整 */
            position: relative;
            z-index: 1; /* コントロールパネルより奥 */
        }

        /* カード本体 */
        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d; /* 3D空間で子要素を配置 */
            transition: transform 0.5s ease; /* 回転アニメーション */
            cursor: default; /* 通常はクリック不可 */
        }

        /* 一時停止中にクリック可能にするクラス */
        .card.clickable {
            cursor: pointer;
        }

        /* カードが裏返った状態 */
        .card.flipped {
            transform: rotateY(180deg); /* Y軸を中心に180度回転 */
        }

        /* カードの表と裏の共通スタイル */
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari用裏面非表示 */
            backface-visibility: hidden; /* 裏面を非表示 */
            padding: 20px; /* 内側の余白 */
            box-sizing: border-box; /* paddingを含めて計算 */
            border-radius: 16px; /* 角を丸める */
            background: rgba(255, 255, 255, 0.1); /* 半透明の背景 */
            backdrop-filter: blur(10px); /* 背景をぼかす（すりガラス効果） */
            -webkit-backdrop-filter: blur(10px); /* Safari用 */
            border: 1px solid rgba(255, 255, 255, 0.2); /* 枠線 */
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3); /* 影 */
            overflow: hidden; /* 内容がはみ出ないように */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between; /* 上下に配置 */
        }

        /* メインコンテンツ（単語/日本語定義）を中央揃えにするためのラッパー */
        .main-content {
            display: flex;
            flex-direction: column; /* h2/pが縦に並ぶように */
            justify-content: center; /* 垂直中央揃え */
            align-items: center; /* 水平中央揃え */
            flex-grow: 1; /* 利用可能なスペースを埋める */
            width: 100%; /* 幅を100%に */
        }

        /* カード表面のスタイル */
        .card-front {
            background: linear-gradient(135deg, rgba(36, 123, 205, 0.5), rgba(16, 54, 140, 0.3)); /* 青系のグラデーション */
            color: white;
        }

        /* カード裏面のスタイル */
        .card-back {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.5), rgba(20, 90, 50, 0.3)); /* 緑系のグラデーション */
            color: white;
            transform: rotateY(180deg); /* 最初から裏返しておく */
            display: none; /* 初期状態は非表示 */
        }

        /* カード内の単語表示 (H2) */
        .card h2 {
            margin: 0; /* マージンリセット */
            font-size: 2.0rem; /* 変更済み */
            font-weight: 600;
            letter-spacing: 1px;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
            background: linear-gradient(to right, #ffffff, #d1d1d1); /* 文字色グラデーション */
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent; /* 文字色を透明に */
            text-align: center; /* 中央揃え */
            max-width: 100%; /* コンテナからはみ出ないように */
        }

        /* 発音記号のスタイル */
        .pronunciation {
            width: 90%; /* はみ出し防止 */
            text-align: center;
            font-size: 0.95rem;
            color: white;
            font-weight: 400;
            line-height: 1.4;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
            margin-top: 5px; /* 上の要素との間に少しマージンを追加 */
        }

        /* ページタイトル下のサブタイトル (H2) - 共通 */
         body > h2#mainSubtitle {
            margin-top:0;
            text-shadow:0 0 5px rgba(255,255,255,0.5);
            font-size:1.2rem; /* 基本サイズ */
            font-weight:400;
            margin-bottom: 5px; /* 下のh3との間隔 */
            line-height:1.5;
            text-align:center;
            background: none; /* グラデーション解除 */
             -webkit-background-clip: unset;
             background-clip: unset;
             -webkit-text-fill-color: unset;
             color: white; /* 色を白に戻す */
             min-height: 1.5em; /* テキスト変更時の高さ変動を防ぐ */
        }

        /* アカデミック英語サブタイトル (H2) */
        h2#academicSubtitle {
            margin: 0; /* マージン削除 */
            font-size: 1.0rem; /* フォントサイズ調整 */
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9); /* 少し明るく */
            text-shadow: 0 0 4px rgba(255, 255, 255, 0.5);
            text-align: center;
            line-height: 1.3; /* 行間調整 */
        }

        /* NAWLサブタイトル (H3) */
        h3#nawlSubtitle {
            margin: 2px 0 10px 0; /* 上マージンを少し追加 */
            font-size: 1.0rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 0 0 3px rgba(255, 255, 255, 0.4);
            text-align: center;
        }

        /* 段落 (P) の汎用スタイル */
        p {
            margin: 5px 0;
            font-size: 18px;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            font-weight: 300; /* 少し細めのフォント */
        }

        /* 裏面の日本語定義スタイル */
        .card-back p.definition-jp {
             max-width: 100%; /* コンテナからはみ出ないように */
            text-align: center; /* 中央揃えは維持 */
            margin: 0; /* マージンリセット */
            font-size: 1.6rem; /* 変更済み */
            color: #FFD700; /* 金色 */
            font-weight: 500;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        }
        /* 裏面の英語定義スタイル (現在は日本語定義を表示) */
        .card-back p.definition-en {
             width: 90%; /* はみ出し防止 */
             text-align: center;
             margin: 0; /* マージンリセット */
             font-size: 0.95rem;
             color: white;
             font-weight: 400;
             line-height: 1.4;
             text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        }

        /* ボタンの共通スタイル */
        .button {
            padding: 12px 24px;
            color: white;
            border: none;
            border-radius: 30px; /* 丸みを帯びたボタン */
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            letter-spacing: 0.5px;
            position: relative; /* :before要素の基準 */
            overflow: hidden; /* :before要素がはみ出ないように */
            transition: all 0.3s ease; /* ホバー効果のトランジション */
            backdrop-filter: blur(5px); /* ボタンの背景ぼかし */
            -webkit-backdrop-filter: blur(5px);
            background: rgba(255, 255, 255, 0.15); /* 半透明背景 */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); /* 影 */
        }

        /* ボタンのホバー時の光沢エフェクト */
        .button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .button:hover:before {
            left: 100%;
        }

        /* スタートボタンのスタイル */
        .start-button {
            background: linear-gradient(45deg, rgba(52, 152, 219, 0.8), rgba(41, 128, 185, 0.8)); /* 青系グラデーション */
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 15px; /* カテゴリグリッドとのマージン */
        }

        .start-button:hover {
            background: linear-gradient(45deg, rgba(52, 152, 219, 0.9), rgba(41, 128, 185, 0.9));
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.5); /* ホバー時の光彩効果 */
            transform: translateY(-2px); /* 少し上に移動 */
        }

        /* コントロール内のボタン共通スタイル */
        .control-button {
             color: white;
             border: none;
             border-radius: 20px;
             cursor: pointer;
             transition: all 0.3s ease;
             padding: 6px 12px; /* パディング調整 */
             font-size: 12px;
             text-align: center;
             min-width: 60px; /* 最小幅設定 */
             flex-grow: 1; /* ボタンが均等に広がるように */
             flex-basis: 0;
        }

        /* 戻るボタン */
        .prev-button {
             background: linear-gradient(45deg, #6c757d, #495057); /* グレー系 */
        }
        .prev-button:hover {
             background: linear-gradient(45deg, #868e96, #5a6268);
             transform: translateY(-1px);
             box-shadow: 0 2px 8px rgba(108, 117, 125, 0.4);
        }

        /* 次へボタン (小) */
        .next-button {
            background: linear-gradient(45deg, rgb(39, 174, 96), rgb(27, 120, 66)); /* 緑系 */
        }
        .next-button:hover {
             background: linear-gradient(45deg, rgb(46, 204, 113), rgb(39, 174, 96));
             transform: translateY(-1px);
             box-shadow: 0 2px 8px rgba(46, 204, 113, 0.4);
        }

        /* 停止ボタン (小) */
        .pause-button {
            background: linear-gradient(45deg, rgb(211, 84, 0), rgb(170, 67, 0)); /* オレンジ系 */
        }
        .pause-button:hover {
            background: linear-gradient(45deg, rgb(243, 156, 18), rgb(211, 84, 0));
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(243, 156, 18, 0.4);
        }
         /* 再生ボタンのスタイル (停止ボタンに resume クラスが付与された場合) */
         .pause-button.resume {
             background: linear-gradient(45deg, rgb(142, 68, 173), rgb(91, 44, 111)); /* 紫系 */
         }
         .pause-button.resume:hover {
             background: linear-gradient(45deg, rgb(155, 89, 182), rgb(142, 68, 173));
             box-shadow: 0 2px 8px rgba(155, 89, 182, 0.4);
         }

        /* 進捗表示エリア (未使用) */
        .progress {
            margin-top: 20px;
            width: 100%;
            text-align: center;
        }

        /* 非表示用クラス */
        .hidden {
            display: none !important; /* 確実に非表示にする */
        }

        /* カードカウンターのスタイル */
        .card-counter {
            font-size: 18px;
            margin-top: 10px; /* 上（タイトル）とのマージン */
            margin-bottom: 10px; /* 下（カード）とのマージン */
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
            background: rgba(0, 0, 0, 0.2); /* 半透明背景 */
            padding: 5px 15px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            display: none; /* 初期状態は非表示、JSで表示 */
            width: fit-content; /* 内容に合わせた幅 */
            text-align: center;
            align-self: center; /* Flexコンテナ内で中央揃え */
            font-family: 'Roboto Mono', monospace; /* 等幅フォント */
        }

        /* コントロール要素のコンテナ */
        .control-container {
             display: flex;
             gap: 15px; /* 要素間の隙間 */
             justify-content: center; /* 中央揃え */
             flex-wrap: wrap; /* 幅が足りなければ折り返す */
             margin-top: 15px; /* カードとの間隔 */
             width: 100%;
             max-width: 500px; /* 最大幅 */
        }

        /* 各コントロールパネル（共通） */
        .control-panel {
            text-align: center;
            padding: 10px 15px;
            background: rgba(13, 16, 33, 0.7); /* 半透明背景 */
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(55, 75, 110, 0.4);
            display: none; /* 初期状態は非表示、JSで表示 */
            flex-direction: column; /* ラベルとボタンを縦に */
            align-items: center; /* 中央揃え */
            justify-content: center; /* ラベルとボタンを垂直中央揃え */
            flex-grow: 1; /* 利用可能なスペースを埋める */
            flex-basis: 0; /* flex-growと合わせて使う */
            min-width: 150px; /* 最小幅を設定 */
            aspect-ratio: 1000 / 618; /* 黄金比を適用 */
        }
        /* パネル内のラベル */
        .control-panel .panel-label {
            color: white;
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 500;
            text-align: center;
            width: 100%;
        }
        /* パネル内のボタンコンテナ */
        .control-panel .panel-buttons {
            display: flex;
            justify-content: center; /* 中央揃えに変更 */
            gap: 8px; /* ボタン間のギャップ調整 */
            width: 100%;
        }

        /* 速度調整ボタン */
        .speed-button {
            background: rgba(86, 101, 115, 0.6);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
             /* 共通スタイルを継承 */
             padding: 6px 12px;
             font-size: 12px;
             text-align: center;
             min-width: 60px;
             flex-grow: 1;
             flex-basis: 0;
        }

        .speed-button:hover {
            background: rgba(128, 140, 141, 0.7);
            transform: translateY(-1px);
        }

        /* 選択中の速度ボタン */
        .speed-button.active {
            background: linear-gradient(45deg, rgb(41, 128, 185), rgb(33, 97, 140));
            font-weight: 500;
            box-shadow: 0 0 10px rgba(41, 128, 185, 0.5);
        }

        /* 選択中カテゴリ表示エリア */
        .category-info {
            margin-top: 20px; /* スタートボタンとのマージン */
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            font-size: 0.9rem;
        }

        /* 注釈テキストのスタイル */
        .disclaimer-text {
            font-size: 0.75rem; /* 小さいフォントサイズ */
            color: rgba(255, 255, 255, 0.6); /* 少し薄い色 */
            margin-top: 10px; /* 上の要素との間隔 */
            text-align: left; /* 左揃え */
            max-width: 600px; /* 最大幅を指定 */
            width: 100%; /* 幅を100%に設定して左揃え */
            line-height: 1.4; /* 行間 */
        }

        /* 免責事項セクションのスタイル */
        .disclaimer-section {
            color: rgba(255, 255, 255, 0.6);
            margin-top: 15px; /* 上の注釈との間隔 */
            text-align: left;
            max-width: 600px;
            width: 100%;
            line-height: 1.4;
        }
        .disclaimer-section h4 {
            font-size: 0.85rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.6); /* カラーをリストアイテムに合わせる */
            margin-bottom: 5px;
            text-align: center; /* タイトルを中央揃え */
        }
        .disclaimer-section ul {
            list-style: disc; /* 箇条書きのマーカー */
            padding-left: 20px; /* 左のパディング */
            margin: 0;
        }
        .disclaimer-section li {
            margin-bottom: 4px; /* 各項目の下のマージン */
            font-size: 0.65rem; /* フォントサイズをさらに下げる */
        }


        /* トップへ戻るボタンのコンテナ */
        .back-button-container {
            margin-top: 20px;
            text-align: center;
        }
        /* トップへ戻るボタン */
        .back-button {
            padding: 8px 20px;
            background: linear-gradient(45deg, rgba(52, 73, 94, 0.8), rgba(44, 62, 80, 0.8)); /* グレー系 */
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            display: none; /* 初期状態は非表示 */
        }
         .back-button:hover {
             background: linear-gradient(45deg, rgba(72, 93, 114, 0.9), rgba(64, 82, 100, 0.9));
             transform: translateY(-1px);
             box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
         }

        /* PC画面表示用のメディアクエリ (769px以上) */
        @media (min-width: 769px) {
            .category-grid {
                grid-gap: 22.5px; /* 1.5倍 */
            }
            .category-card {
                padding: 22px 30px;
                border-radius: 18px;
                min-height: 90px;
            }
            .category-card h3 {
                font-size: 1.35rem;
            }
            .rank-label { font-size: 0.8em; } /* 変更済み */
            .rank-range { font-size: 1.1em; } /* 変更済み */
            .status-preparing {
                font-size: 0.9rem;
            }
        }


        /* レスポンシブ対応 (タブレットサイズ) */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                min-height: 100vh;
                justify-content: flex-start;
            }

            h1 {
                font-size: 2rem;
                margin-top: 10px;
                margin-bottom: 0;
            }

            body > h2#mainSubtitle {
                font-size: 1.1rem; /* 基本サイズ (タブレット) */
                margin-bottom: 3px;
            }

            h2#academicSubtitle { font-size: 0.9rem; }
            h3#nawlSubtitle {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }

            .category-grid {
                grid-gap: 10px;
                margin-top: 10px;
                margin-bottom: 15px;
            }
            .category-card {
                padding: 10px 15px;
                border-radius: 10px;
                min-height: 70px;
            }
             .category-card h3 {
                 font-size: 0.9rem;
                 line-height: 1.2;
             }
             .rank-label { font-size: 0.8em; } /* 変更済み */
             .rank-range { font-size: 1.1em; } /* 変更済み */
             .status-preparing {
                 font-size: 0.6rem;
             }


             .card-counter {
                 margin-top: 8px;
                 margin-bottom: 8px;
                 font-size: 16px;
                 padding: 4px 12px;
             }

            .card-container {
                width: 90%;
                margin: 8px auto 15px auto;
            }

             .card-front, .card-back {
                 padding: 15px;
             }
             /* ★ 変更点: タブレットでの英単語フォントサイズ調整 (1.7rem) */
             .card h2 {
                 font-size: 1.7rem;
             }
             /* ★ 変更点: タブレットでの日本語定義フォントサイズ調整 (1.3rem) */
             .card-back p.definition-jp {
                 font-size: 1.3rem;
             }

             .pronunciation,
             .card-back p.definition-en {
                 font-size: 0.9rem;
             }

            p { font-size: 15px; }

            .button {
                padding: 10px 20px;
                font-size: 15px;
            }
             .start-button { margin-top: 15px; }

             .control-container {
                 gap: 10px;
                 margin-top: 10px;
             }
             .control-panel {
                 padding: 8px 12px;
                 min-width: 0;
             }
             .control-panel .panel-label { font-size: 13px; }

            .category-info {
                margin-top: 15px;
                font-size: 0.85rem;
            }
            /* 免責事項セクション (Tablet) */
            .disclaimer-text { font-size: 0.7rem; }
            .disclaimer-section h4 { font-size: 0.8rem; }
            .disclaimer-section li { font-size: 0.6rem; }

            .back-button-container { margin-top: 15px; }
            .back-button { font-size: 13px; padding: 7px 18px; }
        }

        /* レスポンシブ対応 (スマートフォンサイズ) */
        @media (max-width: 480px) {
             body { padding: 8px; }

            h1 {
                font-size: 1.8rem;
                margin-top: 5px;
            }
             body > h2#mainSubtitle {
                font-size: 1rem; /* 基本サイズ (スマホ) */
                margin-bottom: 2px;
            }

             h2#academicSubtitle { font-size: 0.8rem; }
             h3#nawlSubtitle {
                font-size: 0.8rem;
                margin-bottom: 5px;
            }

             .category-grid {
                /* ★ 変更点: スマホ表示を2カラムに変更 */
                grid-template-columns: repeat(2, 1fr); /* 3カラム -> 2カラム */
                grid-gap: 12px; /* ギャップを少し広げる (10px -> 12px) */
                margin-top: 10px; /* 上マージン調整 */
                margin-bottom: 15px; /* 下マージン調整 */
                width: 92%; /* 幅を少し調整 (95% -> 92%) して左右余白確保 */
                justify-content: center; /* space-around から center に変更 */
             }
            .category-card {
                /* ★ 変更点: 2カラム表示に合わせて調整 */
                padding: 10px 12px; /* パディング調整 */
                border-radius: 8px; /* 角丸調整 */
                min-height: 60px; /* 最小高さ調整 */
            }
             .category-card h3 {
                 font-size: 0.8rem; /* フォントサイズ調整 */
                 line-height: 1.15; /* 行間調整 */
             }
             .rank-label { font-size: 0.9em; margin-bottom: 2px;} /* 変更済み */
             .rank-range { font-size: 1.2em; } /* 変更済み */
             .status-preparing {
                 font-size: 0.6rem; /* フォントサイズ調整 */
                 margin-top: 2px;
             }

             .card-counter {
                 margin-top: 5px;
                 margin-bottom: 5px;
                 font-size: 14px;
                 padding: 4px 12px;
             }

            .card-container {
                width: 95%;
                margin: 5px auto 10px auto;
            }

             .card-front, .card-back { padding: 10px; }
             /* ★ 変更点: スマホでの英単語フォントサイズ調整 (1.5rem) */
             .card h2 {
                 font-size: 1.5rem;
             }
             /* ★ 変更点: スマホでの日本語定義フォントサイズ調整 (1.2rem) */
             .card-back p.definition-jp {
                 font-size: 1.2rem;
             }

             .pronunciation,
             .card-back p.definition-en { font-size: 0.85rem; }

            .button {
                padding: 8px 16px;
                font-size: 14px;
            }
             .start-button { margin-top: 12px; }

             .control-container {
                 gap: 8px;
                 margin-top: 8px;
             }
             .control-panel {
                 padding: 6px 10px;
                 flex-basis: 100%;
                 aspect-ratio: auto;
             }
              .control-panel .panel-label { font-size: 12px; margin-bottom: 5px; }
              #controlBox .panel-buttons { gap: 8px; }
              #speedControl .panel-buttons { gap: 5px; }

            .category-info {
                margin-top: 12px;
                font-size: 0.8rem;
            }
             /* 免責事項セクション (Mobile) */
             .disclaimer-text { font-size: 0.65rem; }
             .disclaimer-section h4 { font-size: 0.75rem; }
            .disclaimer-section li { font-size: 0.55rem; }

             .back-button-container { margin-top: 12px; }
             .back-button { font-size: 12px; padding: 6px 15px; }
        }
    </style>
</head>
<body>
    <div class="stars" id="starsContainer"></div>

    <h1><span>🐿️</span> EIGOASOBI <span>🌸</span></h1>
    <h2 id="mainSubtitle">デジタルフラッシュカード</h2>
    <h2 id="academicSubtitle">アカデミック英語 - 学術英単語</h2>
    <h3 id="nawlSubtitle">New Academic Word List (NAWL) 957</h3>

    <div class="card-counter" id="cardCounter"></div>

    <div class="category-grid">
         <div class="category-card active" id="category-awl1">
            <h3><span class="rank-label">Rank</span><span class="rank-range">001 - 050</span></h3>
         </div>
         <div class="category-card category-disabled" id="category-awl1b">
             <h3><span class="rank-label">Rank</span><span class="rank-range">051 - 100</span></h3>
             <p class="status-preparing">準備中</p>
         </div>
         <div class="category-card category-disabled" id="category-awl2">
            <h3><span class="rank-label">Rank</span><span class="rank-range">101 - 150</span></h3>
            <p class="status-preparing">準備中</p>
        </div>
        <div class="category-card category-disabled" id="category-awl2b">
             <h3><span class="rank-label">Rank</span><span class="rank-range">151 - 200</span></h3>
             <p class="status-preparing">準備中</p>
         </div>
        <div class="category-card category-disabled" id="category-awl3">
            <h3><span class="rank-label">Rank</span><span class="rank-range">201 - 250</span></h3>
            <p class="status-preparing">準備中</p>
        </div>
        <div class="category-card category-disabled" id="category-awl3b">
             <h3><span class="rank-label">Rank</span><span class="rank-range">251 - 300</span></h3>
             <p class="status-preparing">準備中</p>
         </div>
         <div class="category-card category-disabled" id="category-awl4">
            <h3><span class="rank-label">Rank</span><span class="rank-range">301 - 350</span></h3>
            <p class="status-preparing">準備中</p>
        </div>
        <div class="category-card category-disabled" id="category-awl4b">
             <h3><span class="rank-label">Rank</span><span class="rank-range">351 - 400</span></h3>
             <p class="status-preparing">準備中</p>
         </div>
         <div class="category-card category-disabled" id="category-awl5">
            <h3><span class="rank-label">Rank</span><span class="rank-range">401 - 450</span></h3>
            <p class="status-preparing">準備中</p>
        </div>
         <div class="category-card category-disabled" id="category-awl5b">
             <h3><span class="rank-label">Rank</span><span class="rank-range">451 - 500</span></h3>
             <p class="status-preparing">準備中</p>
         </div>
         <div class="category-card category-disabled" id="category-awl6">
            <h3><span class="rank-label">Rank</span><span class="rank-range">501 - 550</span></h3>
            <p class="status-preparing">準備中</p>
        </div>
         <div class="category-card category-disabled" id="category-awl6b">
             <h3><span class="rank-label">Rank</span><span class="rank-range">551 - 600</span></h3>
             <p class="status-preparing">準備中</p>
         </div>
        <div class="category-card category-disabled" id="category-awl7">
            <h3><span class="rank-label">Rank</span><span class="rank-range">601 - 650</span></h3>
            <p class="status-preparing">準備中</p>
        </div>
         <div class="category-card category-disabled" id="category-awl7b">
             <h3><span class="rank-label">Rank</span><span class="rank-range">651 - 700</span></h3>
             <p class="status-preparing">準備中</p>
         </div>
        <div class="category-card category-disabled" id="category-awl8">
            <h3><span class="rank-label">Rank</span><span class="rank-range">701 - 750</span></h3>
            <p class="status-preparing">準備中</p>
        </div>
         <div class="category-card category-disabled" id="category-awl8b">
             <h3><span class="rank-label">Rank</span><span class="rank-range">751 - 800</span></h3>
             <p class="status-preparing">準備中</p>
         </div>
        <div class="category-card category-disabled" id="category-awl9">
            <h3><span class="rank-label">Rank</span><span class="rank-range">801 - 850</span></h3>
            <p class="status-preparing">準備中</p>
        </div>
         <div class="category-card category-disabled" id="category-awl9b">
             <h3><span class="rank-label">Rank</span><span class="rank-range">851 - 900</span></h3>
             <p class="status-preparing">準備中</p>
         </div>
        <div class="category-card category-disabled" id="category-awl10">
            <h3><span class="rank-label">Rank</span><span class="rank-range">901 - 957</span></h3>
            <p class="status-preparing">準備中</p>
        </div>
    </div>

    <div class="card-container hidden" id="cardContainer">
        <div class="card" id="currentCard">
            <div class="card-front" id="cardFront">
                </div>
            <div class="card-back" id="cardBack">
                 </div>
        </div>
    </div>

    <div class="control-container">
        <div class="control-panel" id="controlBox">
            <div class="panel-label">コントロール</div>
            <div class="panel-buttons">
                 <button class="control-button pause-button" id="pauseButtonSmall">停止</button>
                <button class="control-button prev-button" id="prevButtonSmall">戻る</button>
                <button class="control-button next-button" id="nextButtonSmall">次へ</button>
            </div>
        </div>
        <div class="control-panel" id="speedControl">
            <div class="panel-label">表示速度</div>
            <div class="panel-buttons">
                <button class="speed-button active" id="speed2s">２秒</button>
                <button class="speed-button" id="speed1s">１秒</button>
                <button class="speed-button" id="speed0_5s">０.５秒</button>
            </div>
        </div>
    </div>

    <button class="button start-button" id="startButton">スタート</button>

    <div class="category-info" id="categoryInfo">
         選択中: <span id="selectedCategoryText">Rank 001 - 050</span>
    </div>
    <p class="disclaimer-text">Words and ranks are referenced from the official NAWL (New Academic Word List, Browne et al., 2013). Japanese translations in this list are original, created by the author with support from generative AI tools.</p>

    <div class="disclaimer-section">
        <h4>免責事項</h4>
        <ul>
            <li>当サイトおよび本アプリで提供する教材・情報は、学習支援を目的としたものであり、その内容の正確性・信頼性について保証するものではありません。</li>
            <li>利用者が本サービスを使用したことにより生じたいかなる損害についても、運営者は一切の責任を負いかねますので、ご了承ください。</li>
            <li>本サービスの内容は、予告なく変更または削除されることがあります。</li>
        </ul>
    </div>

    <div class="back-button-container">
        <button class="back-button" id="backButton">トップ画面に戻る</button>
    </div>

    <script>
        // 星空エフェクトを生成する関数
        function createStars() {
            const starsContainer = document.getElementById('starsContainer');
            if (!starsContainer) return; // 要素が存在しない場合は処理を中断
            const isMobile = window.innerWidth <= 768 || 'ontouchstart' in window; // モバイル判定
            let starsCount; // 星の数
            // 画面サイズに応じて星の数を調整
            if (isMobile) {
                starsCount = window.innerWidth < 480 ? 50 : 80; // スマホ/タブレット
            } else {
                starsCount = 150; // PC
            }
            starsContainer.innerHTML = ''; // 既存の星をクリア
            // 指定した数の星を生成
            for (let i = 0; i < starsCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                // 星のサイズ、位置、アニメーション時間、遅延、透明度をランダムに設定
                const size = isMobile ? Math.random() * 1.5 + 0.5 : Math.random() * 2 + 1;
                const left = Math.random() * 100;
                const top = Math.random() * 100;
                const duration = isMobile ? 3 + Math.random() * 5 : 4 + Math.random() * 8;
                const delay = Math.random() * 5;
                const opacity = 0.3 + Math.random() * 0.7;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${left}%`;
                star.style.top = `${top}%`;
                star.style.setProperty('--duration', `${duration}s`); // CSS変数に設定
                star.style.setProperty('--opacity', opacity); // CSS変数に設定
                star.style.animationDelay = `${delay}s`;
                starsContainer.appendChild(star); // コンテナに追加
            }
        }
        // ページ読み込み時に星を生成
        window.addEventListener('load', createStars);
        // ウィンドウリサイズ時に星を再生成（タイマーで負荷軽減）
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                 const starsContainer = document.getElementById('starsContainer');
                 if (starsContainer) {
                    starsContainer.innerHTML = ''; // クリア
                    createStars(); // 再生成
                 }
            }, 250); // 250ms後に実行
        });

        // カードデータ (Rank 1-50) - ★ 更新されたデータ
        const cards = [
            // ★ 変更点: 最初の50件のデータを更新
            { front: { word: "repertoire" }, back: { pronunciation: "/ˈrɛp.ərˌtwɑr/", definition_jp: "レパートリー", definition_en: "習得してすぐに披露できる技能や演目のコレクション" } },
            { front: { word: "obtain" }, back: { pronunciation: "/əbˈteɪn/", definition_jp: "獲得する", definition_en: "努力によって何かを手に入れたり所有したりすること" } },
            { front: { word: "distribution" }, back: { pronunciation: "/ˌdɪs.trəˈbju.ʃən/", definition_jp: "分布", definition_en: "物事が特定の地域やグループに広がっている様子" } },
            { front: { word: "parameter" }, back: { pronunciation: "/pəˈræm.ɪ.tər/", definition_jp: "パラメータ", definition_en: "あるものの動作を制御または説明する値" } },
            { front: { word: "aspect" }, back: { pronunciation: "/ˈæs.pɛkt/", definition_jp: "側面", definition_en: "物事の特質や要素；特定の視点や見方" } },
            { front: { word: "dynamic" }, back: { pronunciation: "/daɪˈnæ.mɪk/", definition_jp: "ダイナミック", definition_en: "活発で絶えず変化する；動きやエネルギーに関連する" } },
            { front: { word: "impact" }, back: { pronunciation: "/ˈɪm.pækt/", definition_jp: "影響、衝撃", definition_en: "強い効果や作用；衝突の力" } },
            { front: { word: "domain" }, back: { pronunciation: "/doʊˈmeɪn/", definition_jp: "領域、ドメイン", definition_en: "特定の活動、知識、または影響の範囲；コンピューターでは、インターネット上のアドレス名" } },
            { front: { word: "publish" }, back: { pronunciation: "/ˈpʌb.lɪʃ/", definition_jp: "出版する", definition_en: "文書を印刷物やデジタル形式で一般に公開すること" } },
            { front: { word: "denote" }, back: { pronunciation: "/dɪˈnoʊt/", definition_jp: "表す", definition_en: "何かを表現する、指し示す、または意味すること" } },
            { front: { word: "authority" }, back: { pronunciation: "/əˈθɔr.ɪ.ti/", definition_jp: "権限、権威", definition_en: "統制する力や権利；認められた専門性を持つ人または組織" } },
            { front: { word: "semantic" }, back: { pronunciation: "/sɪˈmæn.tɪk/", definition_jp: "意味論的", definition_en: "言葉や言語の意味に関連する" } },
            { front: { word: "par" }, back: { pronunciation: "/pɑr/", definition_jp: "基準値", definition_en: "標準または規範とみなされる水準や値" } }, // ★ 更新
            { front: { word: "ion" }, back: { pronunciation: "/ˈaɪ.ɒn/", definition_jp: "イオン", definition_en: "電子を得たり失ったりして電荷を帯びた原子や分子" } }, // ★ 更新
            { front: { word: "matrix" }, back: { pronunciation: "/ˈmeɪ.trɪks/", definition_jp: "マトリックス、行列", definition_en: "物事が生まれ発展する構造や環境；数学では、数字や記号を行と列に並べた矩形配列（くけいはいれつ）" } },// ★ 更新
            { front: { word: "linear" }, back: { pronunciation: "/ˈlɪn.i.ər/", definition_jp: "線形", definition_en: "一直線に並んだ；数学では、直線で表現できる関係を含む" } }, // ★ 更新
            { front: { word: "cognitive" }, back: { pronunciation: "/ˈkɒg.nɪ.tɪv/", definition_jp: "認知的", definition_en: "知覚、思考、理解、学習、記憶などの心の働き（心的過程）に関連する" } },// ★ 更新
            { front: { word: "graph" }, back: { pronunciation: "/græf,.grɑf/", definition_jp: "グラフ", definition_en: "変数やデータ間の関係を示す図；数学では、頂点と辺からなる構造" } },// ★ 更新
            { front: { word: "correlation" }, back: { pronunciation: "/ˌkɔr.əˈleɪ.ʃən/", definition_jp: "相関", definition_en: "2つの変数がどの程度一緒に変動するかを示す統計的関係" } },// ★ 更新
            { front: { word: "linguistic" }, back: { pronunciation: "/lɪŋˈgwɪs.tɪk/", definition_jp: "言語の、言語学的な", definition_en: "言語の構造や使用、または言語学的研究に関連する" } },// ★ 更新
            { front: { word: "acid" }, back: { pronunciation: "/ˈæs.ɪd/", definition_jp: "酸", definition_en: "溶液中で水素イオン（H⁺）を放出し、塩基と反応する物質；通常は酸味を持つ" } },// ★ 更新
            { front: { word: "induce" }, back: { pronunciation: "/ɪn.djus/", definition_jp: "誘発する", definition_en: "何かを引き起こしたり生じさせたりすること；人を説得したり影響を与えたりして、ある行動をするよう仕向けること" } },// ★ 更新
            { front: { word: "velocity" }, back: { pronunciation: "/vəˈlɒs.ɪ.ti/", definition_jp: "速度（ベクトル量）", definition_en: "ある方向への変位の時間変化率（向きと大きさを持つ速さ）" } },// ★ 更新
            { front: { word: "interval" }, back: { pronunciation: "/ˈɪn.tər.vəl/", definition_jp: "間隔", definition_en: "二つの点や数値、時刻の間の距離または差" } },// ★ 更新
            { front: { word: "discourse" }, back: { pronunciation: "/ˈdɪs.kɔrs/", definition_jp: "談話、言説、論述", definition_en: "特定のテーマに関する形式的な議論や意見交換（特に口頭や文章において）" } },
            { front: { word: "finite" }, back: { pronunciation: "/ˈfaɪ.naɪt/", definition_jp: "有限", definition_en: "限界あるいは境界を持つこと；限られた時間しか続かないこと" } },
            { front: { word: "stimulus" }, back: { pronunciation: "/stɪmyələs/", definition_jp: "刺激", definition_en: "反応や応答を引き起こすもの" } },
            { front: { word: "vector" }, back: { pronunciation: "/ˈvɛk.tər/", definition_jp: "ベクトル", definition_en: "大きさと方向の両方を持つ量" } },
            { front: { word: "electron" }, back: { pronunciation: "/ɪˈlɛk.trɒn/", definition_jp: "電子", definition_en: "負に帯電した粒子" } },
            { front: { word: "receptor" }, back: { pronunciation: "/rɪˈsɛp.tər/", definition_jp: "受容体", definition_en: "特定の信号や刺激を受け取り反応する構造" } },
            { front: { word: "theorem" }, back: { pronunciation: "/ˈθɪər.əm/", definition_jp: "定理", definition_en: "推論によって証明できる数学的または論理的命題" } },
            { front: { word: "algorithm" }, back: { pronunciation: "/ˈæl.gəˌrɪð.əm/", definition_jp: "アルゴリズム", definition_en: "特定の問題を解決したり計算を実行したりするために設計された体系的な論理手順" } },
            { front: { word: "fluid" }, back: { pronunciation: "/ˈflu.ɪd/", definition_jp: "流体", definition_en: "力が加わると形状を変え流動する物質で、液体と気体の両方を含む。例：水、空気" } },
            { front: { word: "developmental" }, back: { pronunciation: "/dɪˈvɛl.əp.mənt/", definition_jp: "発達的", definition_en: "物事や人の段階的な発展や成長に関する" } },
            { front: { word: "bound" }, back: { pronunciation: "/baʊnd/", definition_jp: "制約される、飛び跳ねる", definition_en: "何かに制限または支配されること; 跳躍したり弾んだりすること" } },
            { front: { word: "molecular" }, back: { pronunciation: "/məˈlɛk.jə.lər/", definition_jp: "分子的", definition_en: "分子に関する、分子から成る、または分子に特徴的な" } },
            { front: { word: "transformation" }, back: { pronunciation: "/ˌtræns.fərˈmeɪ.ʃən/", definition_jp: "変換、変容、変形", definition_en: "形態、外観、または性質における重要な変化" } },
            { front: { word: "spatial" }, back: { pronunciation: "/ˈspeɪ.ʃəl/", definition_jp: "空間的", definition_en: "空間における物体の位置や配置に関する" } },
            { front: { word: "coefficient" }, back: { pronunciation: "/ˌkoʊ.əˈfɪʃ.ənt/", definition_jp: "係数", definition_en: "数学において変数や式に掛けられる数値" } },
            { front: { word: "translation" }, back: { pronunciation: "/trænzleɪʃən/", definition_jp: "翻訳", definition_en: "あるものを別の形に変換するプロセス。特に文章をある言語から別の言語に移し替えること" } },
            { front: { word: "membrane" }, back: { pronunciation: "/ˈmɛm.breɪn/", definition_jp: "膜", definition_en: "生物体内で境界を形成する薄い組織層" } },
            { front: { word: "neuron" }, back: { pronunciation: "/ˈnʊər.ɒn/", definition_jp: "ニューロン", definition_en: "神経細胞；神経系の基本的な構成要素" } },
            { front: { word: "simulation" }, back: { pronunciation: "/ˌsɪm.jəˈleɪ.ʃən/", definition_jp: "シミュレーション", definition_en: "システムの特性を研究するために、その振る舞いを模倣するモデル" } },
            { front: { word: "lexical" }, back: { pronunciation: "/ˈlɛk.sɪ.kəl/", definition_jp: "語彙的", definition_en: "言語の語彙や単語に関する" } },
            { front: { word: "regime" }, back: { pronunciation: "/rəˈʒim/", definition_jp: "体制", definition_en: "特定の方針によって特徴づけられる統治または行政の制度" } },
            { front: { word: "variance" }, back: { pronunciation: "/ˈvɛər.i.əns/", definition_jp: "分散", definition_en: "値が平均からばらつく程度" } },
            { front: { word: "molecule" }, back: { pronunciation: "/ˈmɒl.əˌkjul/", definition_jp: "分子", definition_en: "化学結合によって結びついた2つ以上の原子の集まり" } },
            { front: { word: "marker" }, back: { pronunciation: "/ˈmɑr.kər/", definition_jp: "マーカー（標識、指標）", definition_en: "特定の位置、境界、または特性を示す物体、記号、または特徴" } },
            { front: { word: "empirical" }, back: { pronunciation: "/ɛmˈpɪr.ɪ.kəl/", definition_jp: "経験的", definition_en: "理論ではなく、観察や実験に基づく" } },
            { front: { word: "robot" }, back: { pronunciation: "/ˈroʊ.bɒt/", definition_jp: "ロボット", definition_en: "作業を自動的に、または自律的に実行するようプログラムされた機械" } }
        ];
        // ★ 選択されたカテゴリの総カード数を保持する変数
        let currentCategoryCards = []; // ★ カテゴリごとのカードを保持
        let totalCardsInCategory = 0; // ★ カテゴリの総カード数を保持
        // TODO: 将来的にカテゴリごとのカードデータをロードする処理を追加する

        // DOM要素の取得 (getElementByIdのショートカット)
        const getElement = (id) => document.getElementById(id);
        const cardContainer = getElement('cardContainer');
        const currentCard = getElement('currentCard');
        const cardFront = getElement('cardFront');
        const cardBack = getElement('cardBack');
        const startButton = getElement('startButton');
        const cardCounter = getElement('cardCounter');
        const speedControl = getElement('speedControl');
        const speed2sButton = getElement('speed2s');
        const speed1sButton = getElement('speed1s');
        const speed0_5sButton = getElement('speed0_5s');
        const controlBox = getElement('controlBox');
        const prevButtonSmall = getElement('prevButtonSmall');
        const nextButtonSmall = getElement('nextButtonSmall');
        const pauseButtonSmall = getElement('pauseButtonSmall');
        const backButton = getElement('backButton');
        const categoryGrid = document.querySelector('.category-grid');
        const categoryInfo = getElement('categoryInfo');
        const selectedCategoryText = getElement('selectedCategoryText');
        const categoryCards = document.querySelectorAll('.category-card');
        const mainSubtitle = getElement('mainSubtitle');
        // ★ 追加: 新しいサブタイトルの要素を取得
        const academicSubtitle = getElement('academicSubtitle');
        const nawlSubtitle = getElement('nawlSubtitle');
        const disclaimerText = document.querySelector('.disclaimer-text');

        // 状態変数
        let currentCardIndex = 0; // 現在表示しているカードのインデックス
        let autoFlipTimer = null; // カードを自動で裏返すタイマー
        let autoNextTimer = null; // 次のカードへ自動で進むタイマー
        let isPaused = false; // 一時停止中かどうかのフラグ
        let flipDelay = 2000; // カードが表示されてから裏返るまでの時間 (ミリ秒)
        let autoAdvance = true; // 自動進行するかどうかのフラグ (現在は常にtrue)
        let currentRankInfo = ''; // 現在選択中のランク情報

        // カードの表示を更新する関数
        function showCardFront(index) {
             // ★ 変更点: currentCategoryCards を参照
             if (!currentCategoryCards || index < 0 || index >= currentCategoryCards.length) return;
            const card = currentCategoryCards[index]; // ★ 変更点
            if (!cardFront || !cardBack || !cardCounter || !currentCard) return; // 要素のチェック

            // カード表面のHTMLを生成・設定
            cardFront.innerHTML = `
                <div class="main-content">
                    <h2>${card.front.word}</h2> </div>
                <span class="pronunciation">${card.back.pronunciation}</span> `; // ★ 発音記号を表示
            // カード裏面のHTMLを生成・設定
            cardBack.innerHTML = `
                 <div class="main-content">
                    <p class="definition-jp">${card.back.definition_jp}</p> </div>
                 <p class="definition-en">${card.back.definition_en}</p> `; // 日本語定義

            // カードカウンターの表示を更新 (総数を3桁表示)
            // 変更点: totalCardsInCategory を参照
            cardCounter.innerHTML = `<span style="margin-right: 5px;">Rank</span><span id="rank-value-span" style="font-family: 'Roboto Mono', monospace; min-width: 40px; display: inline-block; text-align: right;">${(index + 1).toString().padStart(3, '0')}</span><span> / ${totalCardsInCategory.toString().padStart(3, '0')}</span>`;

            // カード裏面を非表示に設定
            if (cardBack) cardBack.style.display = 'none';

            // カードを表面に戻す (flippedクラスを削除)
            currentCard.classList.remove('flipped');
            void currentCard.offsetHeight; // 強制リフロー (アニメーションのため)

            // 一時停止状態に応じてクリック可能クラスを制御
             if (currentCard) {
                 currentCard.classList.toggle('clickable', isPaused);
             }

            // 自動進行タイマーの設定 (一時停止中でなければ)
            if (autoAdvance && !isPaused) {
                clearTimeout(autoFlipTimer); // 既存のタイマーをクリア
                clearTimeout(autoNextTimer);
                // 指定時間後にカードを裏返すタイマーを設定
                autoFlipTimer = setTimeout(() => {
                    if (!isPaused && currentCard && cardBack) {
                        cardBack.style.display = 'flex'; // 裏面を表示状態にする
                        currentCard.classList.add('flipped'); // 回転アニメーション開始
                        // さらに指定時間後に次のカードへ進むタイマーを設定
                        autoNextTimer = setTimeout(nextCard, flipDelay);
                    }
                }, flipDelay);
            }
        }

        // 次のカードへ進む関数
        function nextCard() {
            clearTimeout(autoFlipTimer); // タイマークリア
            clearTimeout(autoNextTimer);
            // ★ 変更点: currentCategoryCards.length を使用
            currentCardIndex = (currentCardIndex + 1) % currentCategoryCards.length;
            showCardFront(currentCardIndex); // 新しいカードを表示
        }

        // 前のカードへ戻る関数
        function prevCard() {
            isPaused = true; // 自動進行を停止
            // 停止ボタンを「再生」表示に変更
            if (pauseButtonSmall) {
                pauseButtonSmall.textContent = '再生';
                pauseButtonSmall.classList.add('resume');
            }
            if (currentCard) currentCard.classList.add('clickable'); // カードをクリック可能に
            clearTimeout(autoFlipTimer); // タイマークリア
            clearTimeout(autoNextTimer);
            currentCardIndex--; // インデックスを戻す
            // ★ 変更点: currentCategoryCards.length を使用
            if (currentCardIndex < 0) {
                currentCardIndex = currentCategoryCards.length - 1;
            }
            showCardFront(currentCardIndex); // 前のカードを表示
        }

        // 表示速度を設定する関数
        function setSpeed(seconds) {
            flipDelay = seconds * 1000; // 表示時間をミリ秒に変換
            // すべての速度ボタンから active クラスを削除
            [speed2sButton, speed1sButton, speed0_5sButton].forEach(btn => {
                if(btn) btn.classList.remove('active');
            });
            // 対応するボタンに active クラスを追加
            let activeButton;
            if (seconds === 2) activeButton = speed2sButton;
            else if (seconds === 1) activeButton = speed1sButton;
            else if (seconds === 0.5) activeButton = speed0_5sButton;
            if(activeButton) activeButton.classList.add('active');
            // 一時停止中でなければ、タイマーをリセットして現在のカードを再表示
            if (!isPaused) {
                clearTimeout(autoFlipTimer);
                clearTimeout(autoNextTimer);
                showCardFront(currentCardIndex);
            }
        }

        // UI表示を切り替える関数 (カテゴリ選択画面 ⇔ フラッシュカード画面)
        function showFlashcardView(show) {
             const displayGrid = show ? 'none' : 'grid'; // カテゴリグリッドの表示/非表示
             const displayApp = show ? 'block' : 'none'; // カードコンテナ等の表示/非表示
             const displayFlexApp = show ? 'flex' : 'none'; // コントロールパネルの表示/非表示 (flex)
             const displayDisclaimer = show ? 'none' : 'block'; // 注釈の表示/非表示

             // 各要素の表示スタイルを設定
             if (categoryGrid) categoryGrid.style.display = displayGrid;
             if (categoryInfo) categoryInfo.style.display = show ? 'none' : 'block'; // カテゴリ情報は選択画面でのみ表示
             if (startButton) startButton.classList.toggle('hidden', show); // スタートボタンは選択画面でのみ表示

             if (cardContainer) cardContainer.classList.toggle('hidden', !show); // カードコンテナはカード画面でのみ表示
             if (cardCounter) cardCounter.style.display = show ? 'inline-block' : 'none'; // カウンターはカード画面でのみ表示
             if (controlBox) controlBox.style.display = displayFlexApp; // コントロールはカード画面でのみ表示
             if (speedControl) speedControl.style.display = displayFlexApp; // 速度調整はカード画面でのみ表示
             if (backButton) backButton.style.display = show ? 'inline-block' : 'none'; // 戻るボタンはカード画面でのみ表示

             if (disclaimerText) disclaimerText.style.display = displayDisclaimer; // 注釈は選択画面でのみ表示
             // ★ 免責事項セクションの表示/非表示を追加
             const disclaimerSection = document.querySelector('.disclaimer-section');
             if (disclaimerSection) disclaimerSection.style.display = displayDisclaimer;


             // ★ 変更点: サブタイトルの表示/非表示のみ切り替え、内容は変更しない
             if (mainSubtitle && academicSubtitle && nawlSubtitle) {
                 if (show) { // カード画面
                     // サブタイトルは常に表示させるため、ここでは何もしない
                 } else { // カテゴリ選択画面
                     // サブタイトルは常に表示させるため、ここでは何もしない
                 }
             }
        }

        // 選択中のカテゴリ情報を更新・表示する関数
        function setActiveCategoryInfo() {
            const activeCard = document.querySelector('.category-card.active'); // activeクラスを持つカテゴリカードを取得
            if (activeCard) {
                currentRankInfo = activeCard.querySelector('h3')?.textContent || ''; // h3要素のテキストを取得
                 // Rank 001 - 050 の場合、表示を整形
                if (currentRankInfo === 'Rank 001 - 050') { // ★ 変更点: 初期表示のテキストを更新
                    // 何もしない (または必要に応じて整形)
                }
                if(selectedCategoryText) selectedCategoryText.textContent = currentRankInfo; // 表示エリアに設定
            }
        }
        setActiveCategoryInfo(); // 初期読み込み時に実行

        // --- イベントリスナーの設定 ---

        // スタートボタンのクリックイベント
        if (startButton) {
            startButton.addEventListener('click', () => {
                const activeCard = document.querySelector('.category-card.active'); // 選択中のカテゴリカードを取得

                // 準備中のカテゴリが選択されていたら処理を中断
                if (activeCard && activeCard.classList.contains('category-disabled')) {
                     // 必要であればアラート表示: alert("このカテゴリは現在準備中です。");
                     return; // 処理を終了
                }

                // ★ 選択されたカテゴリに応じてカードデータと総数を設定
                if (activeCard && activeCard.id === 'category-awl1') {
                    currentCategoryCards = cards.slice(0, 50); // 最初の50件を取得
                    totalCardsInCategory = currentCategoryCards.length; // 総数を50に設定
                } else {
                    // 他のカテゴリが選択された場合の処理
                    // TODO: 他のカテゴリのカードデータをロードし、currentCategoryCards と totalCardsInCategory を設定
                    // ★ 仮: Rank 1-50 以外のカテゴリは準備中として扱う
                    console.log("Selected category data is not ready yet.");
                    alert("このカテゴリのデータは現在準備中です。"); // ユーザーに通知
                    return; // 処理を終了
                    // currentCategoryCards = cards; // ★ 仮: 全データを使用
                    // totalCardsInCategory = currentCategoryCards.length; // ★ 仮: 全データ数
                }

                // 準備中でなければフラッシュカードを開始
                setActiveCategoryInfo(); // 選択中カテゴリ情報を設定
                showFlashcardView(true); // フラッシュカード画面を表示 (UI要素の表示切替のみ行う)
                currentCardIndex = 0; // 最初のカードから開始
                isPaused = false; // 一時停止解除
                // 停止ボタンを「停止」表示に戻す
                if (pauseButtonSmall) {
                    pauseButtonSmall.textContent = '停止';
                    pauseButtonSmall.classList.remove('resume');
                }
                setSpeed(flipDelay / 1000); // 現在設定されている速度で開始
                showCardFront(currentCardIndex); // 最初のカードを表示
                // カードにクリックイベントリスナーを設定（手動フリップ用）
                if (currentCard) {
                    currentCard.removeEventListener('click', handleCardClick); // 念のため既存を削除
                    currentCard.addEventListener('click', handleCardClick);
                }
            });
        }
        // トップへ戻るボタンのクリックイベント
        if (backButton) {
            backButton.addEventListener('click', () => {
                showFlashcardView(false); // カテゴリ選択画面を表示 (UI要素の表示切替のみ行う)
                clearTimeout(autoFlipTimer); // タイマークリア
                clearTimeout(autoNextTimer);
                isPaused = true; // 一時停止状態にする
                // カードのクリックイベントリスナーを削除
                if (currentCard) {
                    currentCard.removeEventListener('click', handleCardClick);
                }
            });
        }
        // カードの手動フリップ処理
        function handleCardClick() {
            // 一時停止中のみ手動フリップを許可
            if (isPaused && currentCard && cardBack) {
                if (currentCard.classList.contains('flipped')) { // 裏面が表示されている場合
                    currentCard.classList.remove('flipped'); // 表面に戻す
                    // アニメーション完了後に裏面を非表示にする
                    setTimeout(() => {
                         if (cardBack) cardBack.style.display = 'none';
                    }, 500); // 0.5秒 (CSSのtransition時間)
                } else { // 表面が表示されている場合
                    cardBack.style.display = 'flex'; // 裏面を表示状態にしてから
                    currentCard.classList.add('flipped'); // 回転させる
                }
            }
        }
        // 戻るボタン (小) のクリックイベント
        if (prevButtonSmall) prevButtonSmall.addEventListener('click', prevCard);
        // 次へボタン (小) のクリックイベント
        if (nextButtonSmall) {
            nextButtonSmall.addEventListener('click', () => {
                 isPaused = true; // 一時停止状態にする
                 // 停止ボタンを「再生」表示に変更
                 if (pauseButtonSmall) {
                     pauseButtonSmall.textContent = '再生';
                     pauseButtonSmall.classList.add('resume');
                 }
                 if (currentCard) currentCard.classList.add('clickable'); // カードをクリック可能に
                 clearTimeout(autoFlipTimer); // タイマークリア
                 clearTimeout(autoNextTimer);
                 nextCard(); // 次のカードへ
            });
        }
        // 停止/再生ボタン (小) のクリックイベント
        if (pauseButtonSmall) {
            pauseButtonSmall.addEventListener('click', () => {
                isPaused = !isPaused; // 一時停止状態を反転
                if (isPaused) { // 停止する場合
                    clearTimeout(autoFlipTimer); // タイマークリア
                    clearTimeout(autoNextTimer);
                    pauseButtonSmall.textContent = '再生'; // ボタン表示を「再生」に
                    pauseButtonSmall.classList.add('resume'); // resumeクラスを追加 (スタイル変更用)
                    if (currentCard) currentCard.classList.add('clickable'); // カードをクリック可能に
                } else { // 再生する場合
                    pauseButtonSmall.textContent = '停止'; // ボタン表示を「停止」に
                    pauseButtonSmall.classList.remove('resume'); // resumeクラスを削除
                    if (currentCard) currentCard.classList.remove('clickable'); // カードをクリック不可に
                    // カードの状態に応じてタイマーを再開
                    if (currentCard && currentCard.classList.contains('flipped')) { // 裏面が表示されている場合
                         autoNextTimer = setTimeout(nextCard, flipDelay); // 次のカードへ進むタイマーを再開
                    } else { // 表面が表示されている場合
                         showCardFront(currentCardIndex); // カード表示関数を呼び出してタイマーを再開
                    }
                }
            });
        }
        // 速度ボタンのクリックイベント
        if (speed2sButton) speed2sButton.addEventListener('click', () => setSpeed(2));
        if (speed1sButton) speed1sButton.addEventListener('click', () => setSpeed(1));
        if (speed0_5sButton) speed0_5sButton.addEventListener('click', () => setSpeed(0.5));
        // カテゴリカードのクリックイベント
        categoryCards.forEach(card => {
             if (!card) return;
            card.addEventListener('click', () => {
                // 無効なカテゴリは選択できないようにする (コメントアウト中)
                // if (card.classList.contains('category-disabled')) {
                //     return;
                // }

                // すべてのカテゴリカードから active クラスを削除
                categoryCards.forEach(c => { if(c) c.classList.remove('active'); });
                // クリックされたカードに active クラスを追加
                 card.classList.add('active');
                 // 選択中カテゴリ情報を更新
                 setActiveCategoryInfo();
                 // TODO: カテゴリに応じたデータ読み込み処理をここに追加
            });
        });
         // ウィンドウリサイズ時のカード再描画（タイマーで負荷軽減）
         let cardResizeTimer;
         window.addEventListener('resize', () => {
             // フラッシュカードが表示されている場合のみ実行
             if (cardContainer && !cardContainer.classList.contains('hidden')) {
                 clearTimeout(cardResizeTimer);
                 cardResizeTimer = setTimeout(() => {
                     showCardFront(currentCardIndex); // 現在のカードを再表示
                     // 裏面が表示されていた場合は、再表示後にもう一度裏返す
                     if (currentCard && currentCard.classList.contains('flipped')) {
                         currentCard.classList.remove('flipped'); // 一旦表面に
                         void currentCard.offsetHeight; // 強制リフロー
                         cardBack.style.display = 'flex'; // 裏面を表示
                         currentCard.classList.add('flipped'); // 再度裏返す
                     } else if (cardBack) {
                         cardBack.style.display = 'none'; // 表面の場合は裏面を非表示に
                     }
                 }, 250); // 250ms後に実行
             }
         });
    </script>
</body>
</html>
